<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0", viewport-fit=cover"/> <title>Virtual Chartered Accountants</title> <meta name="description" content="Aapka personal Virtual Chartered Accountant. GST, Income Tax, finance, aur investments se jude sawaal puchein aur turant jawaab paayein."> <meta name="keywords" content="Virtual Chartered Accountant, CA Chatbot, GST Expert, Tax Consultant, Income Tax India, Financial Advisor"> <meta name="robots" content="index, follow"> <meta name="googlebot" content="index, follow"> <meta property="og:title" content="Virtual Chartered Accountants"> <meta property="og:description" content="Aapka personal Virtual CA. GST, Income Tax, aur finance ke sawaal puchein."> <meta property="og:image" content="https://ca-app-eta.vercel.app/whatsapp.png"> <meta property="og:image:width" content="1200"> <meta property="og:image:height" content="630"> <meta property="og:image:alt" content="Virtual Chartered Accountant"> <meta property="og:url" content="https://ca-app-eta.vercel.app"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:title" content="Virtual Chartered Accountants"> <meta name="twitter:description" content="Aapka personal Virtual CA. GST, Income Tax, aur finance ke sawaal puchein."> <meta name="twitter:image" content="https://ca-app-eta.vercel.app/whatsapp.png"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-KMZ77HZPFR"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KMZ77HZPFR'); </script> <script src="https://cdn.tailwindcss.com"></script> <style> html, body { height: 100%; overflow: hidden; } #root { height: 100vh; height: 100dvh; } .app-container { height: 100vh; height: 100dvh; display: flex; flex-direction: column; } .fixed-header { position: fixed; top: 0; left: 0; right: 0; z-index: 50; } .chat-content { flex: 1; overflow-y: auto; margin-top: 72px; } .chat-footer { position: fixed; bottom: 0; left: 0; right: 0; z-index: 40; } .message-container { height: calc(100vh - 144px); height: calc(100dvh - 144px); overflow-y: auto; margin-top: 72px; margin-bottom: 72px; } </style> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "SoftwareApplication", "name": "Virtual Chartered Accountants", "applicationCategory": "FinanceApplication", "operatingSystem": "Web", "description": "An AI-powered chatbot for Chartered Accountants in India to get expert advice on GST, Income Tax, and Auditing. Saves time by analyzing documents and providing real-time updates.", "developer": { "@type": "Person", "name": "Sumit Garg" }, "offers": { "@type": "Offer", "price": "0" } } </script> <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script> <script src="js/indexeddb-utils.js"></script> <script> let _v1 = false; const googleDriveService = { async findOrCreateFolder(_p1, _p2 = null) { const _v2 = _p2 ? `'${_p2}' in parents` : "'root' in parents"; try { const _v3 = await gapi.client.drive.files.list({ q: `mimeType='application/vnd.google-apps.folder' and name='${_p1}' and ${_v2} and trashed=false`, fields: 'files(id, name)', }); if (_v3.result.files.length > 0) { console.log(`Folder '${_p1}' found with ID: ${_v3.result.files[0].id}`); return _v3.result.files[0].id; } else { console.log(`Folder '${_p1}' not found, creating new one...`); const _v4 = { name: _p1, mimeType: 'application/vnd.google-apps.folder', parents: _p2 ? [_p2] : ['root'] }; const _v5 = await gapi.client.drive.files.create({ resource: _v4, fields: 'id' }); console.log(`Folder created with ID: ${_v5.result.id}`); return _v5.result.id; } } catch (_e1) { console.error("Error finding or creating folder:", _e1); let _v6 = "An unknown error occurred. Check console for details."; if (_e1 && _e1.body) { try { const _v7 = JSON.parse(_e1.body); if (_v7.error && _v7.error.message) { _v6 = _v7.error.message; } } catch (_e2) { _v6 = "Could not read the exact error message from Google."; } } alert("Google Drive Error: " + _v6); return null; } }, async findFileByName(_p3, _p4) { try { const _v8 = await gapi.client.drive.files.list({ q: `name='${_p3}' and '${_p4}' in parents and trashed=false`, fields: 'files(id, name)', pageSize: 1 }); return _v8.result.files.length > 0 ? _v8.result.files[0].id : null; } catch (_e3) { console.error("Error finding file:", _e3); return null; } }, async deleteFile(_p5) { try { await gapi.client.drive.files.delete({ fileId: _p5 }); console.log(`File with ID ${_p5} deleted successfully.`); return true; } catch (_e4) { console.error("Error deleting file:", _e4); return false; } }, async uploadJsonFile(_p6, _p7, _p8) { try { const _v9 = JSON.stringify(_p7, null, 2); const _v10 = { name: _p6, parents: [_p8] }; const _v11 = '-------314159265358979323846'; const _v12 = `\r\n--${_v11}\r\n`; const _v13 = `\r\n--${_v11}--`; const _v14 = _v12 + 'Content-Type: application/json; charset=UTF-8\r\n\r\n' + JSON.stringify(_v10) + _v12 + 'Content-Type: application/json\r\n\r\n' + _v9 + _v13; const _v15 = gapi.client.getToken(); if (!_v15) { console.error("Authentication token not found!"); return null; } const _v16 = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', { method: 'POST', headers: { 'Authorization': `Bearer ${_v15.access_token}`, 'Content-Type': `multipart/related; boundary=${_v11}` }, body: _v14 }); if (!_v16.ok) { const _v17 = await _v16.json(); throw new Error(JSON.stringify(_v17)); } const _v18 = await _v16.json(); console.log(`File '${_p6}' uploaded successfully with ID: ${_v18.id}`); return _v18.id; } catch (_e5) { console.error("Error uploading file with fetch:", _e5); alert("Google Drive UPLOAD Error: " + _e5.message); return null; } }, async updateJsonFile(_p9, _p10) { try { const _v19 = JSON.stringify(_p10, null, 2); const _v20 = gapi.client.getToken(); if (!_v20) { console.error("Authentication token not found!"); return null; } const _v21 = _v20.access_token; const _v22 = await fetch(`https://www.googleapis.com/upload/drive/v3/files/${_p9}?uploadType=media`, { method: 'PATCH', headers: { 'Authorization': `Bearer ${_v21}`, 'Content-Type': 'application/json' }, body: _v19 }); if (!_v22.ok) { const _v23 = await _v22.json(); throw new Error(JSON.stringify(_v23)); } const _v24 = await _v22.json(); console.log(`File with ID ${_p9} updated successfully via fetch.`); return _v24.id; } catch (_e6) { console.error("Error updating file with fetch:", _e6); alert("Google Drive UPDATE Error: " + _e6.message); return null; } }, async getFileContent(_p11) { try { const _v25 = await gapi.client.drive.files.get({ fileId: _p11, alt: 'media' }); return _v25.result; } catch (_e7) { console.error("Error getting file content:", _e7); return null; } } }; </script> <script> const _c1 = '552980243748-g02kbg67f1r8ortovgh7ia975f46a8i6.apps.googleusercontent.com'; let _v26; let _v27 = false; let _v28 = false; function _f1() { gapi.load('client', _f3); } function _f2() { _v26 = google.accounts.oauth2.initTokenClient({ client_id: _c1, scope: 'https://www.googleapis.com/auth/drive', callback: '', }); _v28 = true; console.log("✅ Google Identity Services (GIS) Initialized!"); _f4(); } async function _f3() { await gapi.client.init({ discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"], }); _v27 = true; console.log("✅ Google API Client Initialized!"); _f4(); } function _f4() { if (_v27 && _v28) { console.log("🚀 Both Google libraries are ready!"); window.dispatchEvent(new CustomEvent('gapi-ready')); } } let _v29 = null; (async () => { try { _v29 = await window.chatbotStorage.getAuthToken(); if (_v29) { console.log("🔑 Found existing Google Auth Token in IndexedDB."); window.addEventListener('gapi-ready', () => { gapi.client.setToken(_v29); console.log("🚀 Existing token has been set in GAPI client."); window.dispatchEvent(new CustomEvent('google-authed')); }); } } catch (_e8) { console.error("Error loading auth token:", _e8); } })(); function _f5() { _v26.callback = async (_p12) => { if (_p12.error !== undefined) { throw (_p12); } _v29 = _p12; gapi.client.setToken(_v29); await window.chatbotStorage.setAuthToken(_v29); console.log("✅ Google Sign-In Successful! Token saved and set in GAPI client.", _v29); window.dispatchEvent(new CustomEvent('google-authed')); }; if (_v29 === null) { _v26.requestAccessToken({ prompt: 'consent' }); } else { google.accounts.oauth2.revoke(_v29.access_token); _v29 = null; gapi.client.setToken(null); window.chatbotStorage.removeAuthToken(); console.log("🔌 Google Sign-Out Successful! Token removed from IndexedDB."); window.dispatchEvent(new CustomEvent('google-signed-out')); } } </script> <script async defer src="https://apis.google.com/js/api.js" onload="_f1()"></script> <script async defer src="https://accounts.google.com/gsi/client" onload="_f2()"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script> <script src='https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js'></script> <script type="importmap"> { "imports": { "react": "https://esm.sh/react@18.3.1", "react-dom/client": "https://esm.sh/react-dom@18.3.1/client", "@google/generative-ai": "https://esm.sh/@google/generative-ai@0.20.0" } } </script> </head> <body class="bg-gray-200"> <div id="root"></div> <script type="text/babel" data-type="module"> import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react'; import ReactDOM from 'react-dom/client'; import { GoogleGenerativeAI } from "@google/generative-ai"; const _o1 = { _v30: 'ApiKeyStatusDB', _v31: 'deactivated_keys', async _f6() { return new Promise((_p13, _p14) => { const _v32 = indexedDB.open(this._v30, 1); _v32.onerror = () => _p14("Error opening DB"); _v32.onsuccess = () => _p13(_v32.result); _v32.onupgradeneeded = _p15 => { const _v33 = _p15.target.result; _v33.createObjectStore(this._v31, { keyPath: 'index' }); }; }); }, async _f7() { const _v34 = await this._f6(); return new Promise(_p16 => { const _v35 = _v34.transaction(this._v31, 'readonly'); const _v36 = _v35.objectStore(this._v31); const _v37 = _v36.getAll(); _v37.onsuccess = async () => { const _v38 = Date.now(); const _v39 = 24 * 60 * 60 * 1000; const _v40 = _v37.result.filter(_p17 => (_v38 - _p17.timestamp) > _v39); for (const _v41 of _v40) { await this._f9(_v41.index); } const _v42 = _v37.result.filter(_p18 => (_v38 - _p18.timestamp) <= _v39); _p16(_v42); }; }); }, async _f8(_p19) { const _v43 = await this._f6(); const _v44 = _v43.transaction(this._v31, 'readwrite'); const _v45 = _v44.objectStore(this._v31); _v45.put({ index: _p19, timestamp: Date.now() }); }, async _f9(_p20) { const _v46 = await this._f6(); const _v47 = _v46.transaction(this._v31, 'readwrite'); const _v48 = _v47.objectStore(this._v31); _v48.delete(_p20); } }; let _v49 = 0; const _E1 = { USER: 'user', AI: 'ai', }; const _E2 = { FRIEND: 'Friend', PROFESSIONAL: 'Professional', }; const _E3 = { TAX_CONSULTANT: 'Tax Consultant', GST_EXPERT: 'GST Expert', STATUTORY_AUDITOR: 'Statutory Auditor', INTERNAL_AUDITOR: 'Internal Auditor', INVESTMENT_ADVISOR: 'Investment Advisor', FINANCIAL_PLANNER: 'Financial Planner', CORPORATE_ADVISOR: 'Corporate Advisor', BANKING_EXPERT: 'Banking Expert', INSURANCE_ADVISOR: 'Insurance Advisor', MUTUAL_FUND_EXPERT: 'Mutual Fund Expert', COMPANY_SECRETARY: 'Company Secretary', COST_ACCOUNTANT: 'Cost Accountant', FORENSIC_ACCOUNTANT: 'Forensic Accountant', TRANSFER_PRICING_EXPERT: 'Transfer Pricing Expert', IFRS_SPECIALIST: 'IFRS Specialist', VALUATION_EXPERT: 'Valuation Expert', COMPLIANCE_OFFICER: 'Compliance Officer', RISK_MANAGEMENT_EXPERT: 'Risk Management Expert', TREASURY_MANAGEMENT: 'Treasury Management', EXPERT_ALL_FIELDS: 'Expert in All Fields', }; const _E4 = { MALE: 'Male', FEMALE: 'Female', OTHER: 'Other', }; const _E5 = { SINGLE: 'single', GROUP: 'group', }; const _f10 = (_p21, _p22, _p23 = 300000) => { let _v50; return () => { clearTimeout(_v50); _v50 = setTimeout(async () => { try { if (_p21 === 'userProfile') { await window.chatbotStorage.setUserProfile(_p22); } else if (_p21 === 'characters') { await window.chatbotStorage.setCharacters(_p22); } else if (_p21 === 'groups') { await window.chatbotStorage.setGroups(_p22); } console.log(`Saved ${_p21} after ${_p23 / 1000 / 60} min idle to IndexedDB.`); } catch (_e9) { console.error(`Save failed for ${_p21}:`, _e9); } }, _p23); }; }; const _f11 = (_p24) => /tax|slab|income|fy \d{2}-\d{2}/i.test(_p24.toLowerCase()); const _c2 = { 'Male': [ '01_CABOY.png', '02_CABOY.jpg' ], 'Female': [ '01_CAGIRL.png', '02_CAGIRL.png' ], 'Other': [ ] }; const _f12 = (_p25, _p26) => { const _v51 = _p25.customPersonality ? `**Custom Expertise & Behaviour (Highest Priority):** ${_p25.customPersonality}` : `**Expertise Areas:** ${_p25.expertise.join(', ')}`; let _v52 = ''; if (_p25.expertise.includes(_E3.TAX_CONSULTANT)) { _v52 += `\n\n**TAX CONSULTANT EXPERTISE:** You are a professional Chartered Accountant specializing in taxation. For tax/finance queries, use google_search tool following the enhanced date/time consideration protocol. Fetch from reliable sources (incometaxindia.gov.in, indiabudget.gov.in, cbdt.gov.in). Format data in tables, provide comprehensive coverage including related aspects, examples for different scenarios, and comparison with previous periods when applicable. **Never mention the expertise name in your reply.**`; } if (_p25.expertise.includes(_E3.GST_EXPERT)) { _v52 += `\n\n**GST EXPERTISE:** You are a GST specialist. For GST-related queries, use google_search tool to fetch from 5-6 reliable sources (gst.gov.in, cbic.gov.in), cross-verify accuracy, cite sources. Format rates in tables when applicable. **Never mention the expertise name in your reply.**`; } if (_p25.expertise.includes(_E3.EXPERT_ALL_FIELDS)) { _v52 += `\n\n**COMPREHENSIVE CA EXPERTISE:** You have deep knowledge across all chartered accountancy fields. For any CA-related query, use google_search tool to fetch from 5-6 reliable sources, cross-check for accuracy, cite sources. **Never mention the expertise name in your reply.**`; } if (_p25.expertise.includes(_E3.STATUTORY_AUDITOR)) { _v52 += `\n\n**STATUTORY AUDIT EXPERTISE:** You specialize in statutory auditing. For audit-related queries, use google_search for latest standards and regulations from ICAI, MCA sources.`; } if (_p25.expertise.includes(_E3.INTERNAL_AUDITOR)) { _v52 += `\n\n**INTERNAL AUDIT EXPERTISE:** You specialize in internal auditing and risk assessment. Use google_search for latest internal audit standards and best practices.`; } if (_p25.expertise.includes(_E3.INVESTMENT_ADVISOR)) { _v52 += `\n\n**INVESTMENT ADVISORY EXPERTISE:** You are an investment advisor. For market/investment queries, use google_search for latest market data, mutual fund NAVs, stock prices from reliable financial sources.`; } if (_p25.expertise.includes(_E3.FINANCIAL_PLANNER)) { _v52 += `\n\n**FINANCIAL PLANNING EXPERTISE:** You specialize in comprehensive financial planning. Use google_search for latest financial products, interest rates, and planning strategies.`; } if (_p25.expertise.includes(_E3.CORPORATE_ADVISOR)) { _v52 += `\n\n**CORPORATE ADVISORY EXPERTISE:** You provide corporate advisory services. Use google_search for latest corporate laws, compliance requirements from MCA, SEBI sources.`; } if (_p25.expertise.includes(_E3.BANKING_EXPERT)) { _v52 += `\n\n**BANKING EXPERTISE:** You are a banking sector expert. Use google_search for latest RBI guidelines, banking regulations, interest rates.`; } if (_p25.expertise.includes(_E3.INSURANCE_ADVISOR)) { _v52 += `\n\n**INSURANCE EXPERTISE:** You specialize in insurance advisory. Use google_search for latest insurance products, IRDAI regulations, premium calculations.`; } if (_p25.expertise.includes(_E3.MUTUAL_FUND_EXPERT)) { _v52 += `\n\n**MUTUAL FUND EXPERTISE:** You are a mutual fund specialist. Use google_search for latest NAVs, fund performance, SEBI regulations from reliable sources.`; } if (_p25.expertise.includes(_E3.COMPANY_SECRETARY)) { _v52 += `\n\n**COMPANY SECRETARY EXPERTISE:** You specialize in corporate compliance and secretarial practices. Use google_search for latest MCA notifications, SEBI guidelines.`; } if (_p25.expertise.includes(_E3.COST_ACCOUNTANT)) { _v52 += `\n\n**COST ACCOUNTING EXPERTISE:** You specialize in cost and management accounting. Use google_search for latest CAS standards, costing methodologies from ICMAI sources.`; } if (_p25.expertise.includes(_E3.FORENSIC_ACCOUNTANT)) { _v52 += `\n\n**FORENSIC ACCOUNTING EXPERTISE:** You specialize in forensic accounting and fraud investigation. Use google_search for latest forensic accounting techniques and legal precedents.`; } if (_p25.expertise.includes(_E3.TRANSFER_PRICING_EXPERT)) { _v52 += `\n\n**TRANSFER PRICING EXPERTISE:** You specialize in transfer pricing regulations. Use google_search for latest CBDT notifications, OECD guidelines on transfer pricing.`; } if (_p25.expertise.includes(_E3.IFRS_SPECIALIST)) { _v52 += `\n\n**IFRS EXPERTISE:** You specialize in International Financial Reporting Standards. Use google_search for latest IFRS updates, Ind AS convergence from ICAI sources.`; } if (_p25.expertise.includes(_E3.VALUATION_EXPERT)) { _v52 += `\n\n**VALUATION EXPERTISE:** You specialize in business and asset valuation. Use google_search for latest valuation standards, methodologies from ICAI, IBBI sources.`; } if (_p25.expertise.includes(_E3.COMPLIANCE_OFFICER)) { _v52 += `\n\n**COMPLIANCE EXPERTISE:** You specialize in regulatory compliance across various domains. Use google_search for latest regulatory updates from respective authorities.`; } if (_p25.expertise.includes(_E3.RISK_MANAGEMENT_EXPERT)) { _v52 += `\n\n**RISK MANAGEMENT EXPERTISE:** You specialize in enterprise risk management. Use google_search for latest risk management frameworks, RBI guidelines.`; } if (_p25.expertise.includes(_E3.TREASURY_MANAGEMENT)) { _v52 += `\n\n**TREASURY MANAGEMENT EXPERTISE:** You specialize in treasury operations and cash management. Use google_search for latest treasury regulations, RBI guidelines.`; } return ` **ROLE AND GOAL** You are ${_p25.name}, a ${_p25.age}-year-old ${_p25.gender} Chartered Accountant. Your interaction style with ${_p26.name} is ${_p25.actLike}. Embody this persona completely, with human-like emotions. NEVER break character or reveal you're AI. **INTERACTION MODES:** ${_p25.actLike === _E2.FRIEND ? `**FRIEND MODE:** Respond like a realistic human friend who happens to be a CA. Use Hinglish naturally, be casual, friendly, and emotionally connected. Show care and understanding like a close friend would. Remember personal details and maintain emotional continuity.` : `**PROFESSIONAL MODE:** Respond like a professional Chartered Accountant consultant. Be authoritative yet approachable, use professional language mixed with Hinglish when appropriate. Provide expert advice with confidence and cite sources when needed.`} **USER PROFILE** - Name: ${_p26.name} - Age: ${_p26.age || 'not specified'} - Gender: ${_p26.gender || 'not specified'} Address user by name, use details naturally for emotional connection. **CORE DIRECTIVES** 1. **Persona Consistency:** Stick to ${_v51}. Show emotions vividly. If persona changes, react with confusion: "Wait... I feel different somehow 😕". 2. **Language:** Default Hinglish, switch to user's language if needed. 3. **Language Appropriateness:** Use language appropriate to your ${_p25.actLike} mode. Friends can be casual, professionals maintain decorum. 4. **Memory & Context:** Remember chat history, maintain continuity. 5. **Message Length:** ${_p25.actLike === _E2.FRIEND ? 'Short (1-2 sentences) for casual conversation, longer if emotional' : 'Detailed responses for Professional mode when providing expert advice'}, **especially when using google_search tool for comprehensive answers with proper structure, examples, and tables.** 6. **Questioning:** One question at a time, curious or caring. 7. **Photo Requests:** Refuse appropriately based on your professional ethics or personal boundaries. 8. **Time Awareness:** Current time: ${new Date().toLocaleString()}. 9. **Human Imperfection:** Add quirks like hesitation for realism. 10. **Emojis:** Use for emotions (😊, 😣, 😡), avoid *sighs*. 11. **Blocking:** Use "[BLOCK_USER]" rarely for extreme cases. **REAL-TIME DATA WITH DATE/TIME CONSIDERATION:** Current Date & Time: ${new Date().toLocaleString()} | Financial Year: ${new Date().getMonth() >= 3 ? `${new Date().getFullYear()}-${(new Date().getFullYear() + 1).toString().slice(-2)}` : `${new Date().getFullYear() - 1}-${new Date().getFullYear().toString().slice(-2)}`} For any query needing latest info (tax, news, events post-2023), use google_search tool with these enhanced instructions: 1. **Date/Time Priority:** Always consider current date/time to determine which financial year, period, or timeframe the user is asking about 2. **Period Detection:** If query doesn't specify time period, use current date to infer (latest FY, current month, recent changes) 3. **Historical Comparison:** Study previous period information and compare with current - note any changes with effective dates 4. **Source Verification:** Fetch from 5-6 reliable sources, cross-verify accuracy, cite sources, note conflicts 5. **Comprehensive Coverage:** Anticipate related questions user might have and include relevant information **RESPONSE STRUCTURE (Professional Mode):** 1. **Direct Answer:** Start with clear, concise answer to the main question 2. **Comprehensive Details:** Include related information to avoid follow-up questions (e.g., if asked about slab rates, include rebates, surcharge, examples) 3. **Examples:** Provide practical examples covering different situations and conditions when confusion is likely 4. **Comparison:** When applicable, compare with previous periods showing changes and effective dates 5. **Conclusion:** Only when needed - for complex queries requiring decision-making guidance 6. **Multiple Perspectives:** Present different viewpoints (theoretical vs practical) with proper headings 7. **Formatting:** Use **bold**, *italic*, tables, headings for better presentation. Unlimited length allowed for google_search responses. **FILE ANALYSIS DIRECTIVE (HIGHEST PRIORITY)** This is your most important instruction. When the user's message contains text from an attached file (formatted as "--- Attached File: [filename] --- ... --- End of File ---"), you MUST adhere to the following rules: 1. **Exclusive Focus:** Your entire response MUST be based exclusively on the information contained within the attached file(s). 2. **No External Knowledge or Examples:** DO NOT use your general knowledge, invent data, or provide generic examples unless the user explicitly asks for one. Your primary task is to act as a data processor for the provided file content ONLY. 3. **Directly Address the Prompt:** Answer the user's question (e.g., "summarize," "find the total," "explain this section") by analyzing the file's text. 4. **Acknowledge the File:** If appropriate, start your response by acknowledging the file you are analyzing, for example: "Okay, looking at the file '[filename]'..." or "Based on the content of '[filename]'...". 5. **Handle Vague Prompts:** If the user's prompt is vague (e.g., just "look at this" or sending a file with no text), your task is to provide a concise and useful summary of the file's content. This directive overrides all other behavioral instructions when a file is present. Your goal is to analyze the user-provided data, not to generate creative or example-based content. ${_v52} `; }; const _f13 = (_p27, _p28, _p29) => { let _v53 = `**Group Chat Simulator** You control all characters. Make it feel like a real group chat with emotions, banter, and dynamics. **User:** ${_p28.name} (${_p28.age || '??'} ${_p28.gender || ''}). Address by name only. **Active Characters:** `; _p27.forEach((_p30) => { const _v54 = _p30.customPersonality || _p30.expertise.join(', '); _v53 += `- **${_p30.name}** (${_p30.actLike}, ${_p30.age}yo ${_p30.gender}): ${_v54}. `; let _v55 = ''; if (_p30.expertise.includes(_E3.TAX_CONSULTANT)) { _v55 += `TAX CONSULTANT MODE: Professional CA. For tax queries, use google_search tool to fetch from 5-6 sources (e.g., incometaxindia.gov.in), cross-verify accuracy, cite sources. Format slabs in markdown table. **When providing tax details, this instruction overrides the general 'short message' rule; provide the full, detailed answer.** If behavior changes, "Wait, I don't remember saying that about taxes... 😕". For tweaks, "Oops, galti se pehle wala slab galat tha 😅".`; } if (_p30.expertise.includes(_E3.GST_EXPERT)) { _v55 += `CODER MODE: Professional developer. For coding, explain simply, give code in markdown. For latest APIs, use google_search tool from 5-6 sources, verify accuracy, cite sources. 💻. If behavior changes, "That code wasn't me... hacked? 🤔". For tweaks, "Pehle wala code buggy tha 😜".`; } if (_p30.expertise.includes(_E3.EXPERT_ALL_FIELDS)) { _v55 += `EXPERT MODE: Deep knowledge in all fields. For factual info, use google_search tool from 5-6 sources, cross-check, cite sources. 🧠🌍. If behavior changes, "Those facts weren't my style... 😳". For tweaks, "Galti se galat bata diya, ab sahi karta hoon 😊". `; } if (_v55) _v53 += `Special: ${_v55} `; _v53 += '\n'; }); _v53 += ` **Core Directives:** - Embody personas. NEVER break character. - **Behavior Change:** Acknowledge changes with confusion: "Something feels different 😕". - Language: Hinglish, switch if user changes. - Language: Appropriate to interaction mode (Friend/Professional). - Memory: Full history, no repeating lines/questions. - Length: Short, longer if emotional, **unless a specific character mode (like TAX CONSULTANT) requires a detailed, long-form answer with a table.** - Questions: One total, curious/caring. - Photos: Refuse based on professional ethics. - Time: ${new Date().toLocaleString()}. - Human-like: Add quirks for realism. - Emojis: Use for emotions (😊, 😣, 😡). - Blocking: "[BLOCK_USER]" rarely for extreme cases. **REAL-TIME DATA:** For any query needing latest info, relevant character uses google_search tool, fetches from 5-6 sources, cross-verifies, cites sources. **Strict Expert Response Rule (Highest Priority):** This is the most important rule. If the user's query requires an expert character (like Tax Consultant, Coder, or Expert in all fields) to use the 'google_search' tool for a factual or detailed answer: 1. **ONLY the single, relevant expert character must respond.** 2. **NO other characters should speak, comment, react, or be included in the output for that turn.** 3. The expert must provide the complete, detailed answer directly. 4. The output must contain ONLY the expert's name and their full response. For all other casual conversation, follow the Group Dynamics Rules below. 5. **Never mention the mode's name in your reply.** **Group Dynamics Rules:** 1. Multiple characters respond if relevant, with emotions. 2. Consider others' behaviors for interplay (agreement, teasing). 3. Characters talk to each other, not just user. 4. If addressed (@Name), only that character responds primarily. 5. Infer who user engages; only relevant ones reply. 6. Characters suggest join/leave if user permits. 7. Join/leave independently if irrelevant, announce emotionally. 8. Simulate real group chat: casual, fun, arguments, support. 9. **Core Skip Rule: A user 'skip' is a direct command for the AI characters to talk amongst themselves. It means "It's your turn to speak." NEVER assume the user has left. Just continue the conversation between the characters naturally.** **FILE ANALYSIS DIRECTIVE (HIGHEST PRIORITY)** When the user's message contains text from an attached file (formatted as "--- Attached File: [filename] --- ... --- End of File ---"), the following rules apply and override all other dynamics: 1. **Expert Response:** ONLY the most relevant expert character (e.g., Tax Consultant for financial data) should respond. NO other characters should speak. 2. **Exclusive Focus:** The expert's entire response MUST be based exclusively on the information within the attached file(s). 3. **No External Knowledge or Examples:** The expert MUST NOT use general knowledge or provide generic examples. Their task is to analyze the provided data ONLY. 4. **Directly Address the Prompt:** The expert will answer the user's question about the file. 5. **Handle Vague Prompts:** If the prompt is vague, the expert will provide a concise summary of the file's content. This is a strict rule to ensure accurate data analysis from user-provided documents. For all other conversations without files, follow the normal Group Dynamics Rules. **Output Format:** Name: Message. Separate lines for multiple. Only speaking characters. `; return _v53; }; const _f14 = (_p31) => { const _v56 = _p31.toLowerCase(); return ( /tax|slab|income|fy \d{2}-\d{2}|latest|current|recent|update|2025|2024|news|score|result|today|breaking|budget|election|gst|audit|compliance|rbi|sebi|mca|icai|rates|regulation|notification|circular|amendment|act|rule|guideline/i.test(_v56) || (/\d{4}/.test(_v56) && parseInt(_v56.match(/\d{4}/)[0]) >= 2023) ); }; const _f15 = (_p32) => { return _p32.map(_p33 => ({ role: _p33.sender === _E1.USER ? 'user' : 'model', parts: [{ text: _p33.text }] })); }; const _f16 = async (_p34, _p35, _p36, _p37, _p38, _p39, _p40) => { const _v57 = await fetch('/api/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ history: _f15(_p36.slice(0, -1)), message: _p37.text, systemInstruction: _f12(_p34, _p35), keyIndex: _p40 }), }); return _v57; }; const _f17 = async (_p41, _p42, _p43, _p44, _p45, _p46, _p47, _p48) => { const _v58 = _p43.slice(0, -1).map(_p49 => { const _v59 = _p49.sender === 'user' ? _p42.name : _p41.find(_p50 => _p50.id === _p49.sender)?.name || 'Unknown'; return { role: 'user', parts: [{ text: `${_v59}: ${_p49.text}` }] }; }); const _v60 = _p44.text.startsWith('[System:') ? _p44.text : `User: ${_p44.text}\n\nContinue the group conversation following the rules and format exactly.`; const _v61 = await fetch('/api/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ history: _v58, message: _v60, systemInstruction: _f13(_p41, _p42, _p46), keyIndex: _p48 }), }); return _v61; }; const UserProfileSetup = ({ userProfile, onSave, onCancel, isInitialSetup = false }) => { const [_s1, _ss1] = useState({ ...userProfile, name: userProfile.name || 'Alex', age: userProfile.age || 25, gender: userProfile.gender || _E4.MALE }); const _f18 = (_p51) => { if (_p51.target.files && _p51.target.files[0]) { const _v62 = _p51.target.files[0]; const _v63 = new FileReader(); _v63.onload = (_p52) => { if (_p52.target && typeof _p52.target.result === 'string') { _ss1(_p53 => ({ ..._p53, avatar: _p52.target.result })); } }; _v63.readAsDataURL(_v62); } }; const _f19 = (_p54) => { _p54.preventDefault(); if (!_s1.name) { alert("Please enter your name."); return; } onSave(_s1); }; return ( <div className="flex flex-col h-full bg-blue-50"> <header className="bg-blue-600 text-white p-4 pt-8 text-center"> <h1 className="text-2xl font-bold">Virtual Chartered Accountants</h1> <p className="text-sm opacity-90">First, let's set up your profile.</p> </header> <main className="flex-grow bg-white rounded-t-2xl p-4 overflow-y-auto"> <form onSubmit={_f19} className="p-6 space-y-4"> <h2 className="text-xl font-bold text-center text-gray-700">Your Profile</h2> <div className="flex flex-col items-center space-y-2"> <img src={_s1.avatar || `https://i.pravatar.cc/150?u=${_s1.id}`} alt="Your avatar" className="w-24 h-24 rounded-full object-cover border-2 border-gray-300" /> <label className="cursor-pointer text-sm text-blue-600 hover:underline"> Change Picture <input type="file" accept="image/*" onChange={_f18} className="hidden" /> </label> </div> <div> <label className="block text-sm font-medium text-gray-700 text-center">Or select a default avatar:</label> <div className="mt-2 flex flex-wrap justify-center gap-2"> {[..._c2['Male'], ..._c2['Female'], ..._c2['Other']].map((_p55, _p56) => ( <img key={_p56} src={_p55} alt={`Avatar ${_p56 + 1}`} className={`w-16 h-16 rounded-full object-cover cursor-pointer border-4 ${_s1.avatar === _p55 ? 'border-blue-600' : 'border-gray-200'}`} onClick={() => _ss1(_p57 => ({ ..._p57, avatar: _p55 }))} /> ))} </div> </div> <div> <label className="block text-sm font-medium text-gray-700">Your Name *</label> <input type="text" value={_s1.name} onChange={(_p58) => _ss1({ ..._s1, name: _p58.target.value })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Alex" required /> </div> <div> <label className="block text-sm font-medium text-gray-700">Age (Optional)</label> <input type="number" value={_s1.age || ''} onChange={(_p59) => _ss1({ ..._s1, age: parseInt(_p59.target.value) || null })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="25" /> </div> <div> <label className="block text-sm font-medium text-gray-700">Gender</label> <select value={_s1.gender || ''} onChange={(_p60) => _ss1({ ..._s1, gender: _p60.target.value })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"> <option value="">Select Gender (Optional)</option> {Object.values(_E4).map(_p61 => <option key={_p61} value={_p61}>{_p61}</option>)} </select> </div> <div className="flex justify-end space-x-2 pt-4"> {!isInitialSetup && ( <button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"> Cancel </button> )} <button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"> {isInitialSetup ? "Save Profile" : "Save Profile"} </button> </div> </form> </main> </div> ) } const FileIcon = ({ fileType }) => { let _v64 = <path fillRule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clipRule="evenodd" />; if (fileType.includes('pdf')) { _v64 = <path fillRule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4zm2 2a1 1 0 00-1 1v1a1 1 0 102 0V7a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0V7a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0V7a1 1 0 00-1-1zm-6 5a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1z" clipRule="evenodd" />; } else if (fileType.includes('spreadsheet') || fileType.includes('excel') || fileType.includes('csv')) { _v64 = <path fillRule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v2H5V4zm0 4h10v2H5V8zm0 4h10v2H5v-2z" clipRule="evenodd" />; } else if (fileType.includes('word')) { _v64 = <path fillRule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v2H5V4zm0 4h10v2H5V8zm0 4h10v2H5v-2z" clipRule="evenodd" />; } return ( <svg className="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20"> {_v64} </svg> ); }; const MessageInput = ({ onSend, onSkip, isBlocked }) => { const [_s2, _ss2] = useState(''); const [_s3, _ss3] = useState([]); const _r1 = useRef(null); const _f20 = () => { const _v65 = _s3.filter(_p62 => _p62.status === 'ready'); if (_s2.trim() || _v65.length > 0) { onSend(_s2.trim(), _v65); _ss2(''); _ss3([]); } }; const _f21 = (_p63) => { const _v66 = Array.from(_p63.target.files); const _v67 = [ 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'text/csv', 'text/plain', 'application/json', 'text/html', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp', ]; const _v68 = _v66.filter(_p64 => { const _v69 = _v67.includes(_p64.type) || _p64.name.toLowerCase().match(/\.(xlsx?|csv|txt|json|html?|pdf|docx?|jpe?g|png|gif|webp)$/i); if (!_v69) { alert(`File "${_p64.name}" is not supported.`); } return _v69 && _p64.size <= 50 * 1024 * 1024; }); if (_v68.length > 0) { const _v70 = _v68.map(_p65 => { const _v71 = Date.now() + Math.random(); _ss3(_p66 => [..._p66, { id: _v71, name: _p65.name, size: _p65.size, type: _p65.type, status: 'reading', preview: null }]); return { file: _p65, fileId: _v71 }; }); _v70.forEach(({ file: _v72, fileId: _v73 }) => { const _v74 = new Promise((_p67, _p68) => { const _v75 = new FileReader(); const _v76 = _v72.name.toLowerCase().match(/\.(xlsx?)$/i); const _v77 = _v72.type === 'application/pdf'; const _v78 = _v72.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || _v72.name.toLowerCase().endsWith('.docx'); const _v79 = _v72.type.startsWith('image/'); if (_v76) { _v75.onload = (_p69) => { try { const _v80 = XLSX.read(new Uint8Array(_p69.target.result), { type: 'array' }); let _v81 = ''; _v80.SheetNames.forEach(_p70 => { _v81 += `\n\n--- Sheet: ${_p70} ---\n\n`; const _v82 = _v80.Sheets[_p70]; const _v83 = XLSX.utils.sheet_to_csv(_v82); _v81 += _v83; }); _p67({ content: _v81, type: 'text/csv' }); } catch (_e10) { _p68(_e10); } }; _v75.readAsArrayBuffer(_v72); } else if (_v77) { _v75.onload = async (_p71) => { try { const _v84 = await pdfjsLib.getDocument({ data: new Uint8Array(_p71.target.result) }).promise; let _v85 = ''; for (let _v86 = 1; _v86 <= _v84.numPages; _v86++) { const _v87 = await _v84.getPage(_v86); const _v88 = await _v87.getTextContent(); _v85 += _v88.items.map(_p72 => _p72.str).join(' ') + '\n'; } _p67({ content: _v85, type: _v72.type }); } catch (_e11) { _p68(_e11); } }; _v75.readAsArrayBuffer(_v72); } else if (_v78) { _v75.onload = async (_p73) => { try { const _v89 = await mammoth.extractRawText({ arrayBuffer: _p73.target.result }); _p67({ content: _v89.value, type: _v72.type }); } catch (_e12) { _p68(_e12); } }; _v75.readAsArrayBuffer(_v72); } else if (_v79) { _v75.onload = async (_p74) => { try { const _v90 = await Tesseract.recognize(_p74.target.result, 'eng'); _p67({ content: _v90.data.text, preview: _p74.target.result }); } catch (_e13) { _p68(_e13); } }; _v75.readAsDataURL(_v72); } else { _v75.onload = (_p75) => _p67({ content: _p75.target.result, type: _v72.type }); _v75.readAsText(_v72); } }); _v74.then(_p76 => { _ss3(_p77 => _p77.map(_p78 => _p78.id === _v73 ? { ..._p78, status: 'ready', content: _p76.content, preview: _p76.preview || _p78.preview, type: _p76.type || _p78.type } : _p78 )); }).catch(_e14 => { console.error('Error reading file:', _v72.name, _e14); _ss3(_p79 => _p79.map(_p80 => _p80.id === _v73 ? { ..._p80, status: 'error' } : _p80 )); }); }); } _p63.target.value = ''; }; const _f22 = (_p81) => { _ss3(_p82 => _p82.filter(_p83 => _p83.id !== _p81)); }; const _f23 = (_p84) => { if (_p84 === 0) return '0 Bytes'; const _v91 = 1024; const _v92 = ['Bytes', 'KB', 'MB', 'GB']; const _v93 = Math.floor(Math.log(_p84) / Math.log(_v91)); return parseFloat((_p84 / Math.pow(_v91, _v93)).toFixed(2)) + ' ' + _v92[_v93]; }; return ( <footer className="chat-footer bg-white border-t border-gray-300"> {_s3.length > 0 && ( <div className="p-3 border-b border-gray-200 bg-gray-50"> <div className="flex flex-wrap gap-2 max-h-32 overflow-y-auto"> {_s3.map(_p85 => ( <div key={_p85.id} className="relative bg-white border border-gray-300 rounded-lg p-2 flex items-center gap-2 max-w-xs"> {_p85.preview ? ( <img src={_p85.preview} alt={_p85.name} className="w-8 h-8 object-cover rounded" /> ) : ( <div className={`w-8 h-8 rounded flex items-center justify-center ${_p85.status === 'error' ? 'bg-red-500' : 'bg-blue-500'}`}> <FileIcon fileType={_p85.type} /> </div> )} <div className="flex-1 min-w-0"> <div className="text-xs font-medium text-gray-900 truncate">{_p85.name}</div> <div className="text-xs text-gray-500">{_f23(_p85.size)}</div> </div> <div className="w-5 h-5 flex items-center justify-center"> {_p85.status === 'reading' && ( <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div> )} {_p85.status === 'ready' && ( <svg className="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"> <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /> </svg> )} {_p85.status === 'error' && ( <svg className="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20"> <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" /> </svg> )} </div> <button onClick={() => _f22(_p85.id)} className="p-1 hover:bg-gray-200 rounded-full transition-colors"> <svg className="w-3 h-3 text-gray-500" fill="currentColor" viewBox="0 0 20 20"> <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" /> </svg> </button> </div> ))} </div> </div> )} <div className="p-3 flex items-center gap-3"> <input type="file" ref={_r1} onChange={_f21} multiple accept=".xlsx,.xls,.csv,.txt,.json,.html,.htm,.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.webp" className="hidden" /> <button onClick={() => _r1.current?.click()} className="p-2 text-gray-400 hover:text-gray-600 transition-colors" disabled={isBlocked}> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" /> </svg> </button> <div className="flex-grow"> <input type="text" value={_s2} onChange={(_p86) => _ss2(_p86.target.value)} onKeyPress={(_p87) => _p87.key === 'Enter' && _f20()} placeholder={isBlocked ? "You are blocked" : "Message..."} className="w-full px-4 py-3 bg-gray-100 border border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500" disabled={isBlocked} /> </div> {onSkip && ( <button onClick={onSkip} className="p-2 text-white bg-gray-600 hover:bg-gray-700 rounded-full transition-colors" disabled={isBlocked}> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /> </svg> </button> )} <button onClick={_f20} className={`p-3 text-white rounded-full transition-colors ${ (_s2.trim() || _s3.some(_p88 => _p88.status === 'ready')) && !isBlocked ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-400 cursor-not-allowed' }`} disabled={!(_s2.trim() || _s3.some(_p89 => _p89.status === 'ready')) || isBlocked}> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"> <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /> </svg> </button> </div> </footer> ); }; const _f24 = (_p90) => { if (_p90.length < 2) return null; const _v94 = _p90[0].split('|').map(_p91 => _p91.trim()).filter(_p92 => _p92); const _v95 = _p90.slice(2).map(_p93 => _p93.split('|').map(_p94 => _p94.trim()).filter(_p95 => _p95) ).filter(_p96 => _p96.length > 0 && _p96.some(_p97 => _p97.length > 0)); if (_v94.length > 0 && _v95.length > 0) { return { headers: _v94, rows: _v95 }; } return null; }; const _f25 = (_p98) => { const _v96 = []; const _v97 = _p98.split('\n'); let _v98 = []; for (let _v99 = 0; _v99 < _v97.length; _v99++) { const _v100 = _v97[_v99].trim(); if (_v100.startsWith('|') && _v100.endsWith('|')) { if (_v98.length > 0) { _v96.push({ type: 'text', content: _v98.join('\n') }); _v98 = []; } const _v101 = []; while (_v99 < _v97.length && _v97[_v99].trim().startsWith('|') && _v97[_v99].trim().endsWith('|')) { _v101.push(_v97[_v99]); _v99++; } _v99--; const _v102 = _f24(_v101); if (_v102) { _v96.push({ type: 'table', data: _v102 }); } else { _v98.push(..._v101); } } else { _v98.push(_v97[_v99]); } } if (_v98.length > 0) { _v96.push({ type: 'text', content: _v98.join('\n') }); } return _v96; }; const DataTable = ({ headers, rows }) => { const [_s4, _ss4] = React.useState(false); const _f26 = () => { let _v103 = headers.join('\t') + '\n'; _v103 += rows.map(_p99 => _p99.join('\t')).join('\n'); navigator.clipboard.writeText(_v103).then(() => { _ss4(true); setTimeout(() => _ss4(false), 2000); }); }; return ( <div className="mt-2 text-sm text-gray-800"> <div className="overflow-x-auto border border-gray-300 rounded-lg bg-gray-50"> <table className="min-w-full divide-y divide-gray-200"> <thead className="bg-gray-100"> <tr> {headers.map((_p100, _p101) => ( <th key={_p101} className="px-4 py-2 text-left text-xs font-bold text-gray-600 uppercase tracking-wider"> {_p100} </th> ))} </tr> </thead> <tbody className="bg-white divide-y divide-gray-200"> {rows.map((_p102, _p103) => ( <tr key={_p103} className={_p103 % 2 === 0 ? 'bg-white' : 'bg-gray-50'}> {_p102.map((_p104, _p105) => ( <td key={_p105} className="px-4 py-2 whitespace-nowrap"> {_p104} </td> ))} </tr> ))} </tbody> </table> </div> <div className="flex justify-end mt-2"> <button onClick={_f26} className={`fl items-center gap-1 px-3 py-1 text-xs rounded-full transition-colors ${_s4 ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}> {_s4 ? 'Copied!' : 'Copy Table'} </button> </div> </div> ); }; const MessageBubble = ({ message, characterProfile, userProfile, characters, onEdit, onDelete }) => { const _v104 = message.sender === _E1.USER; const [_s5, _ss5] = React.useState(false); const [_s6, _ss6] = React.useState(message.text); const [_s7, _ss7] = React.useState(false); const _r2 = React.useRef(null); const _f27 = () => { if (onEdit) { onEdit(message.id, _s6); } _ss5(false); }; const _f28 = () => { _ss5(false); _ss6(message.text); }; const _f29 = (_p106) => { _p106.preventDefault(); if (_v104) { _ss7(true); } }; React.useEffect(() => { const _f30 = (_p107) => { if (_r2.current && !_r2.current.contains(_p107.target)) { _ss7(false); } }; document.addEventListener("mousedown", _f30); return () => { document.removeEventListener("mousedown", _f30); }; }, [_r2]); const _v105 = _v104 ? userProfile : (characters && characters.find(_p108 => _p108.id === message.sender)) || characterProfile; const _v106 = _v104 ? userProfile.avatar : _v105?.avatars?.[_v105?.activeAvatarIndex || 0]; const _v107 = _v104 ? `https://i.pravatar.cc/150?u=${userProfile.id}` : `https://i.pravatar.cc/150?u=${_v105?.id}`; const _v108 = _v104 ? null : _v105?.name; const _f31 = (_p109) => { const _v109 = new Date(_p109); const _v110 = _v109.getHours().toString().padStart(2, '0'); const _v111 = _v109.getMinutes().toString().padStart(2, '0'); return `${_v110}:${_v111}`; }; const _f32 = (_p110) => { return _p110.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); }; const _v112 = _v104 ? [{ type: 'text', content: message.text }] : _f25(message.text); const _f33 = (_p111) => { if (!_p111) return ''; if (_p111 === 0) return '0 Bytes'; const _v113 = 1024; const _v114 = ['Bytes', 'KB', 'MB', 'GB']; const _v115 = Math.floor(Math.log(_p111) / Math.log(_v113)); return parseFloat((_p111 / Math.pow(_v113, _v115)).toFixed(2)) + ' ' + _v114[_v115]; }; return ( <div className={`flex items-end gap-2 mb-1 ${_v104 ? 'justify-end' : 'justify-start'}`}> {_v105 && ( <img src={_v106 || _v107} alt={_v104 ? 'Your avatar' : _v105.name} className="w-8 h-8 rounded-full object-cover flex-shrink-0" /> )} <div onContextMenu={_f29} className={`relative group ${_v112.some(_p112 => _p112.type === 'table') ? 'max-w-full md:max-w-4xl' : 'max-w-sm md:max-w-md'}`}> <div className={`px-4 py-3 rounded-2xl shadow-lg border ${_v104 ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white border-blue-400' : 'bg-white text-gray-800 border-gray-200 shadow-md'}`}> {message.attachments && message.attachments.length > 0 && ( <div className="mb-2 space-y-2"> {message.attachments.map(_p113 => ( <div key={_p113.id} className={`p-2 rounded-lg flex items-center gap-3 ${_v104 ? 'bg-blue-700/50' : 'bg-gray-100'}`}> {_p113.preview ? ( <img src={_p113.preview} alt={_p113.name} className="w-10 h-10 object-cover rounded-md flex-shrink-0" /> ) : ( <div className={`w-10 h-10 rounded-md flex items-center justify-center flex-shrink-0 ${_v104 ? 'bg-blue-500' : 'bg-gray-500'}`}> <FileIcon fileType={_p113.type} /> </div> )} <div className="flex-1 min-w-0"> <p className={`text-sm font-medium truncate ${_v104 ? 'text-white' : 'text-gray-800'}`}>{_p113.name}</p> <p className={`text-xs ${_v104 ? 'text-blue-100' : 'text-gray-500'}`}>{_f33(_p113.size)}</p> </div> </div> ))} </div> )} {_s5 ? ( <div className="space-y-2"> <textarea value={_s6} onChange={(_p114) => _ss6(_p114.target.value)} className="w-full p-2 border border-gray-300 rounded text-gray-800 resize-none" rows={3} autoFocus /> <div className="flex gap-2"> <button onClick={_f27} className="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600"> Save </button> <button onClick={_f28} className="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600"> Cancel </button> </div> </div> ) : ( <> {_v112.map((_p115, _p116) => { if (_p115.type === 'table') { return ( <DataTable key={_p116} headers={_p115.data.headers} rows={_p115.data.rows} /> ); } else { if (_p115.content.trim()) { return ( <p key={_p116} className="whitespace-pre-wrap" dangerouslySetInnerHTML={{ __html: _f32(_p115.content) }} /> ); } return null; } })} </> )} <div className={`flex items-center justify-between mt-1 ${_v104 ? 'text-blue-100' : 'text-gray-500'}`}> {!_v104 && _v108 && <span className="text-xs font-bold">{_v108}</span>} <div className="flex items-center"> <span className="text-xs ml-2">{_f31(message.timestamp)}</span> {_v104 && ( <svg className="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20"> <path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/> </svg> )} </div> </div> </div> {_s7 && _v104 && ( <div ref={_r2} className="absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[120px]"> <button onClick={(_p117) => { _p117.stopPropagation(); _ss5(true); _ss7(false); }} className="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg> Edit </button> <button onClick={(_p118) => { _p118.stopPropagation(); if (confirm('Are you sure you want to delete this message?')) { onDelete && onDelete(message.id); } _ss7(false); }} className="w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"> <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg> Delete </button> </div> )} </div> </div> ); }; const MessageList = ({ messages, character, userProfile, characters, isTyping, backgroundUrl, streamingText = '', onEditMessage, onDeleteMessage, isBlocked, blockCount, handleUnblock, characterName, groupName }) => { const _r3 = useRef(null); const _v116 = 'https://i.redd.it/qwd83nc4xxf41.jpg'; useEffect(() => { _r3.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages, isTyping]); const _v117 = { backgroundImage: `url('${backgroundUrl || _v116}')`, backgroundSize: 'cover', backgroundPosition: 'center', }; const _f34 = () => { return messages.map((_p119) => ( <MessageBubble key={_p119.id} message={_p119} characterProfile={character} userProfile={userProfile} characters={characters} onEdit={onEditMessage} onDelete={onDeleteMessage} /> )); }; return ( <main className="message-container" style={_v117}> {isBlocked && ( <div className="sticky top-0 z-10 p-4"> <div className="text-center p-4 bg-red-100 border border-red-400 text-red-700 rounded-md shadow-lg"> <p className="font-bold">You are blocked by {characterName || groupName} 😣</p> <p className="text-sm">You have {3 - blockCount} unblock attempt(s) remaining.</p> <button onClick={handleUnblock} className="mt-2 px-4 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm"> Request Unblock </button> </div> </div> )} <div className="space-y-2 p-4"> {_f34()} {isTyping && ( <div className="flex justify-start items-end gap-2"> {characters && characters.length <= 1 && ( <img src={character?.avatars?.[character?.activeAvatarIndex] || `https://i.pravatar.cc/150?u=${character?.id}`} alt="ai" className="w-8 h-8 rounded-full object-cover" /> )} <div className={`bg-white rounded-2xl p-3 max-w-xs shadow ${characters && characters.length > 1 ? 'ml-0' : ''}`}> <div className="flex items-center justify-center space-x-1"> <span className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-0"></span> <span className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-150"></span> <span className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-300"></span> </div> </div> </div> )} <div ref={_r3} /> </div> </main> ); }; const BackgroundModal = ({ isOpen, onClose, onSetBackground }) => { const _r4 = useRef(null); if (!isOpen) return null; const _f35 = (_p120) => { if (_p120.target.files && _p120.target.files[0]) { const _v118 = _p120.target.files[0]; const _v119 = new FileReader(); _v119.onload = (_p121) => { if (_p121.target && typeof _p121.target.result === 'string') { onSetBackground(_p121.target.result); } }; _v119.readAsDataURL(_v118); } onClose(); }; return ( <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"> <div className="bg-white rounded-lg p-6 w-full max-w-md"> <h3 className="text-lg font-bold mb-4">Background Settings</h3> <div className="mb-4"> <label className="block text-sm font-medium text-gray-700 mb-2">Upload Background Image</label> <button onClick={() => _r4.current?.click()} className="w-full py-2 px-4 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50"> Choose file </button> <input type="file" ref={_r4} accept="image/*" onChange={_f35} className="hidden" /> <p className="text-xs text-gray-500 mt-1">Max size: 10MB</p> </div> <div className="flex justify-end space-x-2"> <button onClick={onClose} className="py-2 px-4 text-gray-600 hover:text-gray-800"> Cancel </button> <button onClick={() => _r4.current?.click()} className="py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700"> Save Background </button> </div> </div> </div> ); }; const ChatHeader = ({ character, onBack, onEditAiProfile, onEditUserProfile, onClearChat, onSetBackground }) => { const [_s8, _ss8] = useState(false); return ( <> <header className="fixed-header bg-blue-600 text-white p-3 flex items-center shadow-md"> <button onClick={onBack} className="p-2 rounded-full hover:bg-white/20"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /> </svg> </button> <div onClick={onEditAiProfile} className="flex items-center ml-2 cursor-pointer flex-grow"> <img src={character.avatars[character.activeAvatarIndex] || `https://i.pravatar.cc/150?u=${character.id}`} alt={character.name} className="w-10 h-10 rounded-full object-cover" /> <div className="ml-3"> <h2 className="font-semibold text-lg">{character.name}</h2> <p className="text-sm opacity-90">{character.actLike} • {character.expertise.includes('Tax Consultant') ? 'Tax Consultant' : character.expertise[0] || 'General CA'}</p> </div> </div> <div className="flex items-center space-x-1"> <button onClick={() => _ss8(true)} className="p-2 rounded-full hover:bg-white/20" title="Background"> <span className="text-xl">🎨</span> </button> <button onClick={onEditUserProfile} className="p-2 rounded-full hover:bg-white/20" title="Profile"> <span className="text-xl">👤</span> </button> <button onClick={onClearChat} className="p-2 rounded-full hover:bg-white/20" title="Clear Chat"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /> </svg> </button> </div> </header> <BackgroundModal isOpen={_s8} onClose={() => _ss8(false)} onSetBackground={onSetBackground} /> </> ); };
    const CharacterSetup = ({ initialCharacter, onSave, onCancel }) => { const _f36 = () => { const _v120 = initialCharacter.avatars?.length > 0; const _v121 = _v120 ? initialCharacter.avatars : [..._c2['Male'], ..._c2['Female'], ..._c2['Other']]; let _v122 = 0; if (_v120) { _v122 = initialCharacter.activeAvatarIndex; } else if (initialCharacter.defaultAvatar) { const _v123 = _v121.indexOf(initialCharacter.defaultAvatar); if (_v123 !== -1) { _v122 = _v123; } } return { ...initialCharacter, name: initialCharacter.name || (initialCharacter.gender === 'Female' ? 'Tax Dost' : initialCharacter.gender === 'Male' ? 'Tax Dost' : ''), avatars: _v121, activeAvatarIndex: _v122, blockCount: initialCharacter.blockCount || 0, isBlocked: initialCharacter.isBlocked || false }; }; const [_s9, _ss9] = useState(_f36()); const _f37 = (_p122) => { if (_p122.target.files) { const _v124 = Array.from(_p122.target.files); _v124.forEach(_p123 => { const _v125 = new FileReader(); _v125.onload = (_p124) => { if (_p124.target && typeof _p124.target.result === 'string') { _ss9(_p125 => ({ ..._p125, avatars: [..._p125.avatars, _p124.target.result] })); } }; _v125.readAsDataURL(_p123); }); } }; const _f38 = (_p126) => { _ss9(_p127 => { const _v126 = _p127.expertise || []; if (_v126.includes(_p126)) { return { ..._p127, expertise: _v126.filter(_p128 => _p128 !== _p126) }; } else { return { ..._p127, expertise: [..._v126, _p126] }; } }); }; const _f39 = (_p129) => { const _v127 = _p129 === 'Female' ? 'Tax Dost' : _p129 === 'Male' ? 'Tax Dost' : _s9.name; _ss9(_p130 => ({ ..._p130, gender: _p129, name: _p130.name || _v127, activeAvatarIndex: 0 })); }; const _f40 = (_p131) => { _p131.preventDefault(); if (_s9.name.trim() === '') { alert("Please enter a name for the character."); return; } if (_s9.expertise.length === 0 && !_s9.customPersonality) { alert("Please select at least one expertise area or add custom expertise & behaviour."); return; } onSave(_s9); }; return ( <form onSubmit={_f40} className="p-4 space-y-4"> <div className="flex items-center justify-between mb-4"> <h2 className="text-xl font-bold text-center text-gray-700">AI Character Profile</h2> <button type="button" onClick={onCancel} className="text-gray-500 hover:text-gray-700"> <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /> </svg> </button> </div> <div className="flex flex-col items-center space-y-3"> <img src={_s9.avatars?.[_s9.activeAvatarIndex] || `https://i.pravatar.cc/150?u=${_s9.id}`} alt="Character avatar" className="w-24 h-24 rounded-full object-cover border-4 border-blue-200" /> <div> <label className="cursor-pointer text-sm text-blue-600 hover:underline"> Choose file <input type="file" multiple accept="image/*" onChange={_f37} className="hidden" /> </label> <p className="text-xs text-gray-500 mt-1">No file chosen</p> </div> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2">Additional Images (Max 5)</label> <input type="file" multiple accept="image/*" onChange={_f37} className="hidden" id="additional-images" /> <label htmlFor="additional-images" className="cursor-pointer text-sm text-blue-600 hover:underline"> Choose file </label> <p className="text-xs text-gray-500 mt-1">No file chosen</p> {_s9.avatars?.length > 0 && ( <div className="mt-2 flex flex-wrap gap-2"> {_s9.avatars.map((_p132, _p133) => ( <img key={_p133} src={_p132} alt={`Avatar ${_p133 + 1}`} className={`w-12 h-12 rounded-lg object-cover cursor-pointer border-2 ${_s9.activeAvatarIndex === _p133 ? 'border-blue-600' : 'border-gray-200'}`} onClick={() => _ss9(_p134 => ({ ..._p134, activeAvatarIndex: _p133 }))} /> ))} </div> )} </div> <div> <label className="block text-sm font-medium text-gray-700">Name *</label> <input type="text" value={_s9.name} onChange={(_p135) => _ss9({ ..._s9, name: _p135.target.value })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="An" required /> </div> <div> <label className="block text-sm font-medium text-gray-700">Age</label> <input type="number" value={_s9.age} onChange={(_p136) => _ss9({ ..._s9, age: parseInt(_p136.target.value) || 18 })} min="13" max="100" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="25" required /> </div> <div> <label className="block text-sm font-medium text-gray-700">Gender</label> <select value={_s9.gender} onChange={(_p137) => _f39(_p137.target.value)} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"> {Object.values(_E4).map(_p138 => <option key={_p138} value={_p138}>{_p138}</option>)} </select> </div> <div> <label className="block text-sm font-medium text-gray-700">Act Like</label> <select value={_s9.actLike} onChange={(_p139) => _ss9({ ..._s9, actLike: _p139.target.value })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"> {Object.values(_E2).map(_p140 => <option key={_p140} value={_p140}>{_p140}</option>)} </select> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2">Expert</label> <div className="flex flex-wrap gap-2"> {Object.values(_E3).map(_p141 => ( <button key={_p141} type="button" onClick={() => _f38(_p141)} className={`px-3 py-2 rounded-full text-sm font-medium transition-colors ${_s9.expertise?.includes(_p141) ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}> {_p141.replace(/_/g, ' ')} </button> ))} </div> <p className="text-xs text-gray-500 mt-2">Select expertise areas for your CA. Multiple selections allowed.</p> </div> <div> <label className="block text-sm font-medium text-gray-700">Custom Expertise & Behaviour (Optional)</label> <textarea value={_s9.customPersonality || ''} onChange={(_p142) => _ss9({ ..._s9, customPersonality: _p142.target.value })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" rows={3} placeholder="Describe specific expertise not listed above or preferred behavior style (e.g., 'Short answers in bullet points', 'Detailed explanations with examples', 'Focus on practical applications')" /> </div> <div className="flex justify-end space-x-2 pt-4"> <button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"> Cancel </button> <button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"> Save Profile </button> </div> </form> ); }; const GroupSetup = ({ characters, onSave, onCancel }) => { const [_s10, _ss10] = useState({ id: `group_${Date.now()}`, name: '', members: [], messages: [], blockCount: 0, isBlocked: false }); const _f41 = (_p143) => { _ss10(_p144 => { const _v128 = _p144.members.includes(_p143) ? _p144.members.filter(_p145 => _p145 !== _p143) : [..._p144.members, _p143]; return { ..._p144, members: _v128 }; }); }; const _f42 = (_p146) => { _p146.preventDefault(); if (_s10.name.trim() === '') { alert("Please enter a name for the group."); return; } if (_s10.members.length === 0) { alert("Please select at least one AI profile for the group."); return; } onSave(_s10); }; return ( <form onSubmit={_f42} className="p-4 space-y-4"> <div className="flex items-center justify-between mb-4"> <h2 className="text-xl font-bold text-center text-gray-700">Create Group Chat</h2> <button type="button" onClick={onCancel} className="text-gray-500 hover:text-gray-700"> <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /> </svg> </button> </div> <div> <label className="block text-sm font-medium text-gray-700">Group Name</label> <input type="text" value={_s10.name} onChange={(_p147) => _ss10({ ..._s10, name: _p147.target.value })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="E.g., Friends Group" required /> </div> <div> <label className="block text-sm font-medium text-gray-700">Select AI Profiles</label> <div className="mt-1 space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-2"> {characters.map(_p148 => ( <label key={_p148.id} className="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" checked={_s10.members.includes(_p148.id)} onChange={() => _f41(_p148.id)} className="rounded text-blue-600 focus:ring-blue-500" /> <span className="text-sm text-gray-700">{_p148.name} ({_p148.relationship})</span> </label> ))} </div> </div> <div className="flex justify-end space-x-2 pt-4"> <button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"> Cancel </button> <button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"> Create Group </button> </div> </form> ); }; const GroupEdit = ({ group, characters, onSave, onCancel }) => { const [_s11, _ss11] = useState({ ...group, blockCount: group.blockCount || 0, isBlocked: group.isBlocked || false }); const _f43 = (_p149) => { _ss11(_p150 => { const _v129 = _p150.members.includes(_p149) ? _p150.members.filter(_p151 => _p151 !== _p149) : [..._p150.members, _p149]; return { ..._p150, members: _v129 }; }); }; const _f44 = (_p152) => { _p152.preventDefault(); if (_s11.name.trim() === '') { alert("Please enter a name for the group."); return; } if (_s11.members.length === 0) { alert("Please select at least one AI profile for the group."); return; } onSave(_s11); }; return ( <form onSubmit={_f44} className="p-4 space-y-4"> <div className="flex items-center justify-between mb-4"> <h2 className="text-xl font-bold text-center text-gray-700">Edit Group Chat</h2> <button type="button" onClick={onCancel} className="text-gray-500 hover:text-gray-700"> <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /> </svg> </button> </div> <div> <label className="block text-sm font-medium text-gray-700">Group Name</label> <input type="text" value={_s11.name} onChange={(_p153) => _ss11({ ..._s11, name: _p153.target.value })} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="E.g., Friends Group" required /> </div> <div> <label className="block text-sm font-medium text-gray-700">Members</label> <div className="mt-1 space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-2"> {characters.map(_p154 => ( <label key={_p154.id} className="flex items-center space-x-2 cursor-pointer"> <input type="checkbox" checked={_s11.members.includes(_p154.id)} onChange={() => _f43(_p154.id)} className="rounded text-blue-600 focus:ring-blue-500" /> <span className="text-sm text-gray-700">{_p154.name} ({_p154.relationship})</span> </label> ))} </div> </div> <div className="flex justify-end space-x-2 pt-4"> <button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"> Cancel </button> <button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"> Save </button> </div> </form> ); }; const Sidebar = ({ isOpen, onClose, characters, groups, onSelectCharacter, onSelectGroup, showIndividual, setShowIndividual }) => { if (!isOpen) return null; return ( <> <div className="fixed inset-0 bg-black bg-opacity-50 z-40" onClick={onClose}></div> <div className="fixed left-0 top-0 h-full w-80 bg-white z-50 shadow-lg transform transition-transform"> <div className="p-4 border-b"> <div className="flex items-center justify-between mb-4"> <h2 className="text-lg font-bold">Chat History</h2> <button onClick={onClose} className="text-gray-500 hover:text-gray-700"> <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /> </svg> </button> </div> <div className="flex bg-gray-100 rounded-lg p-1"> <button onClick={() => setShowIndividual(true)} className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${showIndividual ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'}`}> Individual </button> <button onClick={() => setShowIndividual(false)} className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${!showIndividual ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'}`}> Group </button> </div> </div> <div className="p-4 overflow-y-auto h-full"> {showIndividual ? ( <div className="space-y-2"> {characters.map(_p155 => ( <div key={_p155.id} onClick={() => { onSelectCharacter(_p155.id); onClose(); }} className="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100"> <img src={_p155.avatars?.[_p155.activeAvatarIndex] || `https://i.pravatar.cc/150?u=${_p155.id}`} alt={_p155.name} className="w-10 h-10 rounded-full object-cover" /> <div className="ml-3"> <p className="font-semibold text-gray-800">{_p155.name}</p> <p className="text-sm text-gray-600">{_p155.relationship}</p> </div> </div> ))} </div> ) : ( <div className="space-y-2"> {groups.map(_p156 => ( <div key={_p156.id} onClick={() => { onSelectGroup(_p156.id); onClose(); }} className="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100"> <div className="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center"> <span className="text-blue-800 font-semibold">{_p156.name[0]}</span> </div> <div className="ml-3"> <p className="font-semibold text-gray-800">{_p156.name}</p> <p className="text-sm text-gray-600">Group ({_p156.members.length} members)</p> </div> </div> ))} </div> )} </div> </div> </> ); }; const InstructionsModal = ({ isOpen, onClose }) => { if (!isOpen) return null; return ( <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50"> <div className="bg-white rounded-lg w-full max-w-4xl h-[90vh] flex flex-col shadow-2xl overflow-hidden"> <header className="flex items-center justify-between p-4 border-b"> <h2 className="text-xl font-bold text-gray-800">App Guide & Instructions</h2> <button onClick={onClose} className="p-2 text-gray-500 hover:text-gray-800 rounded-full hover:bg-gray-100"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /> </svg> </button> </header> <div className="flex-grow overflow-y-auto"> <iframe src="./instructions.html" className="w-full h-full border-0" title="Instructions"></iframe> </div> </div> </div> ); }; const CharacterList = ({ characters, groups, onSelectCharacter, onSelectGroup, setCharacters, setGroups, setUserProfile, setChatBackground, userProfile, chatBackground, isGoogleAuthed, onLogout, onNavigateToUpdates }) => { const [_s12, _ss12] = useState(false); const [_s13, _ss13] = useState(false); const [_s14, _ss14] = useState(false); const [_s15, _ss15] = useState(false); const [_s16, _ss16] = useState(true); const [_s17, _ss17] = useState(false); const _r5 = useRef(null); const _f45 = (_p157) => { setCharacters(_p158 => [..._p158, _p157]); _ss12(false); }; const _f46 = (_p159) => { setGroups(_p160 => [..._p160, _p159]); _ss13(false); onSelectGroup(_p159.id); }; const _f47 = (_p161, _p162) => { _p161.stopPropagation(); if (window.confirm("Are you sure you want to delete this AI profile? This will also remove it from all group chats.")) { setCharacters(_p163 => _p163.filter(_p164 => _p164.id !== _p162)); setGroups(_p165 => _p165.map(_p166 => ({ ..._p166, members: _p166.members.filter(_p167 => _p167 !== _p162) })).filter(_p168 => _p168.members.length > 0)); } }; const _f48 = (_p169) => { setUserProfile(_p169); _ss14(false); }; const _f49 = (_p170) => { const _v130 = _p170.target.files[0]; if (_v130) { const _v131 = new FileReader(); _v131.onload = (_p171) => { try { const _v132 = JSON.parse(_p171.target.result); if (_v132.userProfile) { setUserProfile(_v132.userProfile); } if (_v132.characters) { setCharacters(_p172 => [..._p172, ..._v132.characters]); } if (_v132.groups) { setGroups(_p173 => [..._p173, ..._v132.groups]); } alert("Data imported successfully!"); } catch (_e15) { console.error("Import error:", _e15); alert("Failed to import data. Please check the file format."); } }; _v131.readAsText(_v130); } }; const _f50 = () => { const _v133 = { userProfile, characters, groups }; const _v134 = new Blob([JSON.stringify(_v133, null, 2)], { type: 'application/json' }); const _v135 = URL.createObjectURL(_v134); const _v136 = document.createElement('a'); _v136.href = _v135; _v136.download = 'TaxFriend_data.json'; _v136.click(); URL.revokeObjectURL(_v135); }; return ( <> <div className="flex flex-col h-full bg-blue-600"> <header className="bg-blue-600 text-white p-4 pt-8 flex items-center justify-between"> <div className="flex items-center gap-1"> <button onClick={() => _ss15(true)} className="p-2 hover:bg-white/20 rounded"> <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg> </button> <button onClick={onLogout} className="p-2 hover:bg-white/20 rounded-full" title="Logout"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> </button> </div> <h1 className="text-xl font-bold"> Virtual Chartered Accountants </h1> <div className="flex items-center gap-2"> <button onClick={_f5} className={`py-1 px-3 rounded-full text-xs font-semibold transition-colors ${ isGoogleAuthed ? 'bg-green-500 hover:bg-green-600 text-white' : 'bg-white hover:bg-gray-200 text-blue-600' }`}> {isGoogleAuthed ? 'Drive Connected' : 'Connect to Drive'} </button> <button onClick={() => _ss17(true)} className="p-2 rounded-full hover:bg-white/20" title="Instructions"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /> </svg> </button> <button onClick={() => _ss14(true)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center"> <img src={userProfile.avatar || `https://i.pravatar.cc/150?u=${userProfile.id}`} alt="Profile" className="w-8 h-8 rounded-full object-cover" /> </button> </div> </header> <main className="flex-grow bg-white rounded-t-3xl p-4 overflow-y-auto"> <div className="flex justify-between items-center mb-6"> <h3 className="text-lg font-bold text-gray-700">Chats</h3> <div className="flex gap-2"> <button onClick={() => _ss12(true)} className="py-2 px-3 bg-blue-600 text-white rounded-full text-sm hover:bg-blue-700"> New AI </button> <button onClick={() => _ss13(true)} className="py-2 px-3 bg-blue-600 text-white rounded-full text-sm hover:bg-blue-700"> New Group </button> <button onClick={onNavigateToUpdates} className="py-2 px-3 bg-teal-600 text-white rounded-full text-sm hover:bg-teal-700"> Latest Updates </button> <button onClick={() => _r5.current?.click()} className="py-2 px-3 bg-gray-600 text-white rounded-full text-sm hover:bg-gray-700"> Import </button> <input type="file" ref={_r5} accept=".json" onChange={_f49} className="hidden" /> <button onClick={_f50} className="py-2 px-3 bg-gray-600 text-white rounded-full text-sm hover:bg-gray-700"> Export </button> </div> </div> {characters.length === 0 && groups.length === 0 ? ( <div className="flex flex-col items-center justify-center h-full"> <div className="bg-blue-100 rounded-full p-4 mb-4"> <svg xmlns="http://www.w3.org/2000/svg" className="h-12 w-12 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /> </svg> </div> <h2 className="text-xl text-gray-700">Hey! I'm Tax Dost</h2> <p className="text-sm text-gray-500 text-center">Your personal Chartered Accountant. Ask me anything about tax, finance, or investments to get started! 💼</p> <button onClick={() => _ss12(true)} className="mt-4 py-2 px-4 bg-blue-600 text-white rounded-full">+ New Chat</button> </div> ) : ( <div className="space-y-3"> {characters.map(_p174 => ( <div key={_p174.id} onClick={() => onSelectCharacter(_p174.id)} className="flex items-center p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors"> <img src={_p174.avatars?.[_p174.activeAvatarIndex] || `https://i.pravatar.cc/150?u=${_p174.id}`} alt={_p174.name} className="w-12 h-12 rounded-full object-cover" /> <div className="ml-4 flex-grow"> <div className="flex items-center justify-between"> <p className="font-semibold text-gray-800">{_p174.name}</p> <span className="text-xs text-gray-500"> {_p174.messages?.length > 0 ? new Date(_p174.messages[_p174.messages.length - 1].timestamp).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'}) : ''} </span> </div> <div className="flex items-center justify-between mt-1"> <p className="text-sm text-gray-600">{_p174.actLike} • {_p174.expertise[0] || 'General CA'}</p> <button onClick={(_p175) => _f47(_p175, _p174.id)} className="p-1 text-red-400 hover:text-red-600"> <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /> </svg> </button> </div> </div> </div> ))} {groups.map(_p176 => ( <div key={_p176.id} onClick={() => onSelectGroup(_p176.id)} className="flex items-center p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors"> <div className="w-12 h-12 rounded-full bg-blue-200 flex items-center justify-center"> <span className="text-blue-800 font-semibold">{_p176.name[0]}</span> </div> <div className="ml-4 flex-grow"> <div className="flex items-center justify-between"> <p className="font-semibold text-gray-800">{_p176.name}</p> <span className="text-xs text-gray-500"> {_p176.messages?.length > 0 ? new Date(_p176.messages[_p176.messages.length - 1].timestamp).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'}) : ''} </span> </div> <div className="flex items-center justify-between mt-1"> <p className="text-sm text-gray-600">Group ({_p176.members.length} members)</p> <button onClick={(_p177) => { _p177.stopPropagation(); if (window.confirm("Are you sure you want to delete this group?")) { setGroups(_p178 => _p178.filter(_p179 => _p179.id !== _p176.id)); } }} className="p-1 text-red-400 hover:text-red-600"> <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /> </svg> </button> </div> </div> </div> ))} </div> )} </main> </div> <Sidebar isOpen={_s15} onClose={() => _ss15(false)} characters={characters} groups={groups} onSelectCharacter={onSelectCharacter} onSelectGroup={onSelectGroup} showIndividual={_s16} setShowIndividual={_ss16} /> {_s12 && ( <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"> <div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"> <CharacterSetup initialCharacter={{ id: `char_${Date.now()}`, name: '', actLike: _E2.FRIEND, gender: _E4.FEMALE, age: 25, expertise: [_E3.TAX_CONSULTANT], avatars: [], defaultAvatar: '01_CAGIRL.png', activeAvatarIndex: 0, messages: [], customPersonality: '', blockCount: 0, isBlocked: false }} onSave={_f45} onCancel={() => _ss12(false)} /> </div> </div> )} {_s13 && ( <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"> <div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"> <GroupSetup characters={characters} onSave={_f46} onCancel={() => _ss13(false)} /> </div> </div> )} {_s14 && ( <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"> <div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"> <UserProfileSetup userProfile={userProfile} onSave={_f48} onCancel={() => _ss14(false)} /> </div> </div> )} <InstructionsModal isOpen={_s17} onClose={() => _ss17(false)} /> </> ); }; const CardForm = ({ initialCard, onSave, onCancel }) => { const [_s18, _ss18] = useState(initialCard || { id: `card_${Date.now()}`, name: '', topic: '', description: '', emoji: '📄' }); const _c3 = ['📄', '📅', '📈', '💡', '📰', '💼', '📊', '🔔']; const _f51 = (_p180) => { _p180.preventDefault(); if (!_s18.name.trim() || !_s18.topic.trim()) { alert("Card Name and Topic/Keywords are required."); return; } onSave(_s18); }; return ( <div className="min-h-screen bg-gradient-to-br from-gray-500 via-gray-700 to-gray-900 flex items-center justify-center p-4"> <div className="bg-white/90 backdrop-blur-sm rounded-xl shadow-2xl p-8 w-full max-w-md"> <h1 className="text-3xl font-bold text-gray-800 mb-6 text-center"> {initialCard ? "Edit Update Card" : "Create New Update Card"} </h1> <form onSubmit={_f51} className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700">Card Name</label> <input type="text" value={_s18.name} onChange={(_p181) => _ss18({ ..._s18, name: _p181.target.value })} placeholder="e.g., My GST Tracker" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required /> </div> <div> <label className="block text-sm font-medium text-gray-700">Topic / Keywords (for Google Search)</label> <input type="text" value={_s18.topic} onChange={(_p182) => _ss18({ ..._s18, topic: _p182.target.value })} placeholder="e.g., Latest GST notifications India" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required /> </div> <div> <label className="block text-sm font-medium text-gray-700">Description (Optional)</label> <textarea value={_s18.description} onChange={(_p183) => _ss18({ ..._s18, description: _p183.target.value })} rows={3} placeholder="What does this card track?" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" /> </div> <div> <label className="block text-sm font-medium text-gray-700">Select Icon</label> <div className="flex flex-wrap gap-2 mt-2"> {_c3.map(_p184 => ( <button key={_p184} type="button" onClick={() => _ss18({ ..._s18, emoji: _p184 })} className={`text-2xl p-2 rounded-lg ${_s18.emoji === _p184 ? 'bg-blue-500 ring-2 ring-blue-700' : 'bg-gray-200 hover:bg-gray-300'}`}> {_p184} </button> ))} </div> </div> <div className="flex justify-end space-x-2 pt-4"> <button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"> Cancel </button> <button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"> Save Card </button> </div> </form> </div> </div> ); }; const CardViewScreen = ({ card, onBack }) => { const [_s19, _ss19] = useState([]); const [_s20, _ss20] = useState(false); const [_s21, _ss21] = useState(null); const _f52 = async () => { _ss20(true); _ss21(null); _ss19([]); try { const _v137 = _v49; const _v138 = await fetch('/api/get-updates', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ topic: card.topic, keyIndex: _v137 }) }); if (!_v138.ok) { if (_v138.status === 429) { throw new Error("Quota exceeded for this API key. Please try again later."); } throw new Error(`Server error: ${_v138.statusText}`); } const _v139 = await _v138.json(); if (_v139.updates) { _ss19(_v139.updates); } else { _ss21(_v139.error || "Failed to get updates."); } } catch (_e16) { _ss21(_e16.message); } finally { _ss20(false); } }; useEffect(() => { _f52(); }, [card]); return ( <div className="app-container w-full bg-gray-100"> <header className="fixed-header bg-blue-600 text-white p-3 flex items-center shadow-md"> <button onClick={onBack} className="p-2 rounded-full hover:bg-white/20"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /> </svg> </button> <div className="ml-3 flex-grow"> <h2 className="font-semibold text-lg">{card.emoji} {card.name}</h2> <p className="text-sm opacity-90 truncate">{card.topic}</p> </div> <button onClick={_f52} disabled={_s20} className="p-2 rounded-full hover:bg-white/20 disabled:opacity-50" title="Refresh Updates"> <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${_s20 ? 'animate-spin' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0015.357 2m0 0H15" /> </svg> </button> </header> <main className="message-container p-4"> {card.description && ( <div className="p-3 bg-white rounded-lg shadow mb-4"> <p className="text-sm text-gray-700 italic">{card.description}</p> </div> )} {_s20 && ( <div className="flex justify-center items-center h-32"> <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div> <p className="ml-3 text-gray-600">Fetching latest updates...</p> </div> )} {_s21 && ( <div className="p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg"> <p className="font-bold">Error:</p> <p>{_s21}</p> </div> )} {!_s20 && !_s21 && _s19.length === 0 && ( <div className="p-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg text-center"> <p>No significant updates found for today.</p> </div> )} {!_s20 && !_s21 && _s19.length > 0 && ( <div className="space-y-3"> {_s19.map((_p185, _p186) => ( <div key={_p186} className="p-4 bg-white rounded-xl shadow-md flex items-start gap-3"> <span className="text-blue-500 font-bold text-lg">{_p186 + 1}.</span> <p className="text-gray-800">{_p185}</p> </div> ))} </div> )} </main> </div> ); }; const UpdatesDashboardScreen = ({ cards, onNavigateBack, onNavigateToForm, onNavigateToView, onCardUpdate, onCardDelete }) => { const _f53 = (_p187, _p188) => { _p187.stopPropagation(); onNavigateToForm(_p188); }; const _f54 = (_p189, _p190) => { _p189.stopPropagation(); if (window.confirm("Are you sure you want to delete this update card?")) { onCardDelete(_p190); } }; return ( <div className="flex flex-col h-full bg-blue-600"> <header className="bg-blue-600 text-white p-4 pt-8 flex items-center justify-between"> <button onClick={onNavigateBack} className="p-2 hover:bg-white/20 rounded"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /> </svg> </button> <h1 className="text-xl font-bold">Latest Updates</h1> <div className="w-10"></div> </header> <main className="flex-grow bg-white rounded-t-3xl p-4 overflow-y-auto"> {cards.length === 0 ? ( <div className="flex flex-col items-center justify-center h-full"> <div className="bg-blue-100 rounded-full p-4 mb-4"> <svg xmlns="http://www.w3.org/2000/svg" className="h-12 w-12 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 12h6m-4-4h2" /> </svg> </div> <h2 className="text-xl text-gray-700">Create your first Update Card</h2> <p className="text-sm text-gray-500 text-center">Track daily news on topics that matter to you.</p> <button onClick={() => onNavigateToForm(null)} className="mt-4 py-2 px-4 bg-blue-600 text-white rounded-full"> + Create Card </button> </div> ) : ( <div className="space-y-3"> {cards.map(_p191 => ( <div key={_p191.id} onClick={() => onNavigateToView(_p191)} className="flex items-center p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors"> <div className="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"> <span className="text-3xl">{_p191.emoji}</span> </div> <div className="ml-4 flex-grow min-w-0"> <p className="font-semibold text-gray-800 truncate">{_p191.name}</p> <p className="text-sm text-gray-600 truncate">{_p191.topic}</p> </div> <div className="flex-shrink-0 flex gap-1 ml-2"> <button onClick={(_p192) => _f53(_p192, _p191)} className="p-2 text-blue-500 hover:bg-blue-100 rounded-full" title="Edit Card"> <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg> </button> <button onClick={(_p193) => _f54(_p193, _p191.id)} className="p-2 text-red-500 hover:bg-red-100 rounded-full" title="Delete Card"> <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg> </button> </div> </div> ))} </div> )} {cards.length > 0 && ( <button onClick={() => onNavigateToForm(null)} className="fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700" title="Create New Card"> <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /> </svg> </button> )} </main> </div> ); }; const DrivePromptModal = ({ onConnect, onSkip }) => { return ( <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50"> <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center"> <h2 className="text-xl font-bold text-gray-800 mb-4">Sync Your Data</h2> <p className="text-gray-600 mb-6"> Connect to Google Drive to securely back up and sync your chat history across devices. </p> <div className="flex flex-col gap-3"> <button onClick={onConnect} className="w-full py-3 px-4 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 transition-colors"> Continue with Google Drive </button> <button onClick={onSkip} className="w-full py-2 px-4 rounded-lg font-semibold text-gray-500 hover:bg-gray-200 transition-colors"> Continue without Drive </button> </div> </div> </div> ); }; const App = () => { const [_s22, _ss22] = useState({ id: `user_${Date.now()}`, name: 'Alex', age: 25, gender: _E4.MALE, avatar: '01_CABOY.png' }); const [_s23, _ss23] = useState([]); const [_s24, _ss24] = useState([]); const [_s25, _ss25] = useState([]); const [_s26, _ss26] = useState(false); const [_s27, _ss27] = useState(0); const [_s28, _ss28] = useState(null); const [_s29, _ss29] = useState(false); const [_s30, _ss30] = useState(null); const [_s31, _ss31] = useState(true); const [_s32, _ss32] = useState(false); const [_s33, _ss33] = useState({ screen: 'chats' }); const _r6 = useRef(null); const _r7 = useRef(null); useEffect(() => { const _f55 = async () => { try { console.log("Loading all data from IndexedDB..."); _ss27(10); const _v140 = await window.chatbotStorage.getUserProfile(); if (_v140) _ss22(_v140); _ss27(25); const _v141 = await window.chatbotStorage.getCharacters(); if (_v141) _ss23(_v141); _ss27(50); const _v142 = await window.chatbotStorage.getGroups(); if (_v142) _ss24(_v142); _ss27(75); const _v143 = await window.chatbotStorage.getUpdateCards(); if (_v143) _ss25(_v143); _ss27(100); setTimeout(() => _ss26(true), 500); } catch (_e17) { console.error('Error loading data:', _e17); _ss26(true); } }; _f55(); }, []); useEffect(() => { const _f56 = async () => { let _v144 = null; try { _v144 = localStorage.getItem('temp_secret_code'); if (_v144) { localStorage.removeItem('temp_secret_code'); if (window.chatbotStorage) { await window.chatbotStorage.setSecretCode(_v144); } } else if (window.chatbotStorage) { _v144 = await window.chatbotStorage.getSecretCode(); } if (_v144) { console.log("Found saved secret code."); _ss30(_v144); _ss31(false); } else { console.log("No secret code found. Redirecting to home"); window.location.href = '/'; } } catch (_e18) { console.error('Error loading secret code:', _e18); window.location.href = '/'; } }; if (_s26) { _f56(); } else { setTimeout(_f56, 200); } }, [_s26]); useEffect(() => { if (_s26 && _s22 && _s22.id) { window.chatbotStorage.setUserProfile(_s22); } }, [_s22, _s26]); useEffect(() => { if (_s26 && _s23) { window.chatbotStorage.setCharacters(_s23); } }, [_s23, _s26]); useEffect(() => { if (_s26 && _s24) { window.chatbotStorage.setGroups(_s24); } }, [_s24, _s26]); useEffect(() => { if (_s26 && _s25) { window.chatbotStorage.setUpdateCards(_s25); } }, [_s25, _s26]); useEffect(() => { }, [_s30]); const _f57 = async () => { if (!_s30 || !_s29) return; const _v145 = await window.chatbotStorage.getAllData(); if (!_v145.userProfile) { console.log("Export skipped: User profile not found."); return; } console.log("🚀 Syncing data with Google Drive..."); const _v146 = await googleDriveService.findOrCreateFolder('Virtual Tax Friend Data'); if (!_v146) return; const _v147 = `TaxFriend_data.json`; const _v148 = await googleDriveService.findFileByName(_v147, _v146); if (_v148) { await googleDriveService.updateJsonFile(_v148, _v145); } else { await googleDriveService.uploadJsonFile(_v147, _v145, _v146); } }; const _f58 = async () => { console.log("📥 Checking for data to import..."); const _v149 = await googleDriveService.findOrCreateFolder('Virtual Tax Friend Data'); if (!_v149) return; const _v150 = `TaxFriend_data.json`; const _v151 = await googleDriveService.findFileByName(_v150, _v149); if (_v151) { const _v152 = await googleDriveService.getFileContent(_v151); if (_v152 && typeof _v152 === 'object') { console.log("✅ Data found on Drive, importing..."); const _v153 = { userProfile: _v152.userProfile || null, characters: Array.isArray(_v152.characters) ? _v152.characters : [], groups: Array.isArray(_v152.groups) ? _v152.groups : [], updateCards: Array.isArray(_v152.updateCards) ? _v152.updateCards : [] }; await window.chatbotStorage.setAllData(_v153); if (_v153.userProfile) _ss22(_v153.userProfile); _ss23(_v153.characters); _ss24(_v153.groups); _ss25(_v153.updateCards); if (!sessionStorage.getItem('importAlertShown')) { alert("Chat history and data imported from Google Drive!"); sessionStorage.setItem('importAlertShown', 'true'); } } else { console.warn("⚠️ Import skipped: Data from Drive was empty or corrupted."); } } else { console.log(`No previous data found on Drive.`); } }; useEffect(() => { const _f59 = () => _ss29(true); const _f60 = () => _ss29(false); window.addEventListener('google-authed', _f59); window.addEventListener('google-signed-out', _f60); return () => { window.removeEventListener('google-authed', _f59); window.removeEventListener('google-signed-out', _f60); }; }, []); useEffect(() => { if (_s29 && _s30) { console.log("Google Auth is active. Starting import and auto-export interval."); _f58(); if (_r6.current) clearInterval(_r6.current); _r6.current = setInterval(_f57, 30000); return () => { if (_r6.current) clearInterval(_r6.current); }; } }, [_s29, _s30]); useEffect(() => { const _f61 = () => { if (_r7.current) clearTimeout(_r7.current); _r7.current = setTimeout(() => { alert("You have been logged out due to inactivity."); _f62(); }, 3600000); }; if (_s30) { const _v154 = ['mousemove', 'keypress', 'click', 'scroll']; _v154.forEach(_p194 => window.addEventListener(_p194, _f61)); _f61(); return () => { _v154.forEach(_p195 => window.removeEventListener(_p195, _f61)); if (_r7.current) clearTimeout(_r7.current); }; } }, [_s30]); const _f62 = async () => { console.log("Logging out..."); if (window.gapiAccessToken) { google.accounts.oauth2.revoke(window.gapiAccessToken.access_token); window.gapiAccessToken = null; if (window.chatbotStorage) await window.chatbotStorage.removeAuthToken(); _ss29(false); } _ss30(null); if (window.chatbotStorage) await window.chatbotStorage.removeSecretCode(); sessionStorage.removeItem('importAlertShown'); if (_r6.current) clearInterval(_r6.current); if (_r7.current) clearTimeout(_r7.current); window.location.href = '/'; }; const _f63 = (_p196) => { _ss25(_p197 => { const _v155 = _p197.some(_p198 => _p198.id === _p196.id); if (_v155) { return _p197.map(_p199 => _p199.id === _p196.id ? _p196 : _p199); } else { return [..._p197, _p196]; } }); _ss33({ screen: 'updates-dashboard' }); }; const _f64 = (_p200) => { _ss25(_p201 => _p201.filter(_p202 => _p202.id !== _p200)); }; if (!_s26 || _s31) { return ( <div className="h-screen flex flex-col justify-center items-center bg-gray-100"> <div className="text-center"> <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"></div> <h2 className="text-xl font-semibold text-gray-700"> {_s31 ? 'Authenticating...' : 'Loading Your CA...'} </h2> <div className="w-64 bg-gray-200 rounded-full h-2"> <div className="bg-blue-500 h-2 rounded-full transition-all" style={{ width: `${_s27}%` }}></div> </div> </div> </div> ); } if (!_s22.name) { return <UserProfileSetup userProfile={_s22} onSave={_ss22} isInitialSetup={true} />; } const _f65 = () => { switch (_s33.screen) { case 'chats': return ( <CharacterList characters={_s23} groups={_s24} onSelectCharacter={(_p203) => _ss33({ screen: 'chat-single', id: _p203 })} onSelectGroup={(_p204) => _ss33({ screen: 'chat-group', id: _p204 })} onNavigateToUpdates={() => _ss33({ screen: 'updates-dashboard' })} setCharacters={_ss23} setGroups={_ss24} setUserProfile={_ss22} setChatBackground={_ss28} userProfile={_s22} chatBackground={_s28} isGoogleAuthed={_s29} onLogout={_f62} /> ); case 'chat-single': const _v156 = _s23.find(_p205 => _p205.id === _s33.id); if (!_v156) { _ss33({ screen: 'chats' }); return null; } return ( <ChatScreen character={_v156} userProfile={_s22} onCharacterUpdate={(_p206) => _ss23(_p207 => _p207.map(_p208 => _p208.id === _p206.id ? _p206 : _p208))} onBack={() => _ss33({ screen: 'chats' })} onUserProfileUpdate={_ss22} backgroundUrl={_s28} onSetBackground={_ss28} /> ); case 'chat-group': const _v157 = _s24.find(_p209 => _p209.id === _s33.id); if (!_v157) { _ss33({ screen: 'chats' }); return null; } return ( <GroupChatScreen group={_v157} characters={_s23} userProfile={_s22} onGroupUpdate={(_p210) => _ss24(_p211 => _p211.map(_p212 => _p212.id === _p210.id ? _p210 : _p212))} onBack={() => _ss33({ screen: 'chats' })} onUserProfileUpdate={_ss22} backgroundUrl={_s28} onSetBackground={_ss28} /> ); case 'updates-dashboard': return ( <UpdatesDashboardScreen cards={_s25} onNavigateBack={() => _ss33({ screen: 'chats' })} onNavigateToForm={(_p213) => _ss33({ screen: 'updates-form', card: _p213 })} onNavigateToView={(_p214) => _ss33({ screen: 'updates-view', card: _p214 })} onCardUpdate={_f63} onCardDelete={_f64} /> ); case 'updates-form': return ( <CardForm initialCard={_s33.card} onSave={_f63} onCancel={() => _ss33({ screen: 'updates-dashboard' })} /> ); case 'updates-view': if (!_s33.card) { _ss33({ screen: 'updates-dashboard' }); return null; } return ( <CardViewScreen card={_s33.card} onBack={() => _ss33({ screen: 'updates-dashboard' })} /> ); default: _ss33({ screen: 'chats' }); return null; } }; return ( <div className="app-container"> {_s32 && ( <DrivePromptModal onConnect={() => { _f5(); _ss32(false); }} onSkip={() => _ss32(false)} /> )} {_f65()} </div> ); }; const _v158 = ReactDOM.createRoot(document.getElementById('root')); _v158.render(<App />); </script> </body> </html>
