<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0", viewport-fit=cover/><title>Virtual Chartered Accountants</title><meta name="description" content="Aapka personal Virtual Chartered Accountant. GST, Income Tax, finance, aur investments se jude sawaal puchein aur turant jawaab paayein."><meta name="keywords" content="Virtual Chartered Accountant, CA Chatbot, GST Expert, Tax Consultant, Income Tax India, Financial Advisor"><!-- Allow indexing and link following (default behavior) --><meta name="robots" content="index, follow"><meta name="googlebot" content="index, follow"><meta property="og:title" content="Virtual Chartered Accountants"><meta property="og:description" content="Aapka personal Virtual CA. GST, Income Tax, aur finance ke sawaal puchein."><meta property="og:image" content="https://ca-app-eta.vercel.app/whatsapp.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Virtual Chartered Accountant"><meta property="og:url" content="https://ca-app-eta.vercel.app"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Virtual Chartered Accountants"><meta name="twitter:description" content="Aapka personal Virtual CA. GST, Income Tax, aur finance ke sawaal puchein."><meta name="twitter:image" content="https://ca-app-eta.vercel.app/whatsapp.png"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-KMZ77HZPFR"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-KMZ77HZPFR');</script><script src="https://cdn.tailwindcss.com"></script><style>html,body{height:100%;overflow:hidden;}#root{height:100vh;height:100dvh;}.app-container{height:100vh;height:100dvh;display:flex;flex-direction:column;}.fixed-header{position:fixed;top:0;left:0;right:0;z-index:50;}.chat-content{flex:1;overflow-y:auto;margin-top:72px;}.chat-footer{position:fixed;bottom:0;left:0;right:0;z-index:40;}.message-container{height:calc(100vh - 144px);height:calc(100dvh - 144px);overflow-y:auto;margin-top:72px;margin-bottom:72px;}</style><script type="application/ld+json">{"@context":"https://schema.org","@type":"SoftwareApplication","name":"Virtual Chartered Accountants","applicationCategory":"FinanceApplication","operatingSystem":"Web","description":"An AI-powered chatbot for Chartered Accountants in India to get expert advice on GST, Income Tax, and Auditing. Saves time by analyzing documents and providing real-time updates.","developer":{"@type":"Person","name":"Sumit Garg"},"offers":{"@type":"Offer","price":"0"}}</script><script src="https://unpkg.com/@babel/standalone/babel.min.js"></script><script src="js/indexeddb-utils.js"></script><script>let _a1=false;const _a2={async _a3(_a4,_a5=null){const _a6=_a5?`'${_a5}' in parents`:"'root' in parents";try{const _a7=await gapi.client.drive.files.list({q:`mimeType='application/vnd.google-apps.folder' and name='${_a4}' and ${_a6} and trashed=false`,fields:'files(id, name)'});if(_a7.result.files.length>0){console.log(`Folder '${_a4}' found with ID: ${_a7.result.files[0].id}`);return _a7.result.files[0].id}else{console.log(`Folder '${_a4}' not found, creating new one...`);const _a8={name:_a4,mimeType:'application/vnd.google-apps.folder',parents:_a5?[ _a5 ]:['root']};const _a9=await gapi.client.drive.files.create({resource:_a8,fields:'id'});console.log(`Folder created with ID: ${_a9.result.id}`);return _a9.result.id}}catch(_a10){console.error("Error finding or creating folder:",_a10);let _a11="An unknown error occurred. Check console for details.";if(_a10&&_a10.body){try{const _a12=JSON.parse(_a10.body);if(_a12.error&&_a12.error.message){_a11=_a12.error.message}}catch(_a13){_a11="Could not read the exact error message from Google."}}alert("Google Drive Error: "+_a11);return null}},async _a14(_a15,_a16){try{const _a17=await gapi.client.drive.files.list({q:`name='${_a15}' and '${_a16}' in parents and trashed=false`,fields:'files(id, name)',pageSize:1});return _a17.result.files.length>0?_a17.result.files[0].id:null}catch(_a18){console.error("Error finding file:",_a18);return null}},async _a19(_a20){try{await gapi.client.drive.files.delete({fileId:_a20});console.log(`File with ID ${_a20} deleted successfully.`);return true}catch(_a21){console.error("Error deleting file:",_a21);return false}},async _a22(_a23,_a24,_a25){try{const _a26=JSON.stringify(_a24,null,2);const _a27={name:_a23,parents:[_a25]};const _a28='-------314159265358979323846';const _a29=`\r\n--${_a28}\r\n`;const _a30=`\r\n--${_a28}--`;const _a31=_a29+'Content-Type: application/json; charset=UTF-8\r\n\r\n'+JSON.stringify(_a27)+_a29+'Content-Type: application/json\r\n\r\n'+_a26+_a30;const _a32=gapi.client.getToken();if(!_a32){console.error("Authentication token not found!");return null}const _a33=await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',{method:'POST',headers:{'Authorization':`Bearer ${_a32.access_token}`,'Content-Type':`multipart/related; boundary=${_a28}`},body:_a31});if(!_a33.ok){const _a34=await _a33.json();throw new Error(JSON.stringify(_a34))}const _a35=await _a33.json();console.log(`File '${_a23}' uploaded successfully with ID: ${_a35.id}`);return _a35.id}catch(_a36){console.error("Error uploading file with fetch:",_a36);alert("Google Drive UPLOAD Error: "+_a36.message);return null}},async _a37(_a38,_a39){try{const _a40=JSON.stringify(_a39,null,2);const _a41=gapi.client.getToken();if(!_a41){console.error("Authentication token not found!");return null}const _a42=_a41.access_token;const _a43=await fetch(`https://www.googleapis.com/upload/drive/v3/files/${_a38}?uploadType=media`,{method:'PATCH',headers:{'Authorization':`Bearer ${_a42}`,'Content-Type':'application/json'},body:_a40});if(!_a43.ok){const _a44=await _a43.json();throw new Error(JSON.stringify(_a44))}const _a45=await _a43.json();console.log(`File with ID ${_a38} updated successfully via fetch.`);return _a45.id}catch(_a46){console.error("Error updating file with fetch:",_a46);alert("Google Drive UPDATE Error: "+_a46.message);return null}},async _a47(_a48){try{const _a49=await gapi.client.drive.files.get({fileId:_a48,alt:'media'});return _a49.result}catch(_a50){console.error("Error getting file content:",_a50);return null}}}</script><script>const _a51='552980243748-g02kbg67f1r8ortovgh7ia975f46a8i6.apps.googleusercontent.com';let _a52;let _a53=false;let _a54=false;function _a55(){gapi.load('client',_a56)}function _a57(){_a52=google.accounts.oauth2.initTokenClient({client_id:_a51,scope:'https://www.googleapis.com/auth/drive',callback:''});_a54=true;console.log("âœ… Google Identity Services (GIS) Initialized!");_a58() }async function _a56(){await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]});_a53=true;console.log("âœ… Google API Client Initialized!");_a58()}function _a58(){if(_a53&&_a54){console.log("ðŸš€ Both Google libraries are ready!");window.dispatchEvent(new CustomEvent('gapi-ready'))}}let _a59=null;(async()=>{try{_a59=await window.chatbotStorage.getAuthToken();if(_a59){console.log("ðŸ”‘ Found existing Google Auth Token in IndexedDB.");window.addEventListener('gapi-ready',()=>{gapi.client.setToken(_a59);console.log("ðŸš€ Existing token has been set in GAPI client.");window.dispatchEvent(new CustomEvent('google-authed'))})}}catch(_a60){console.error("Error loading auth token:",_a60)}})();function _a61(){_a52.callback=async(_a62)=>{if(_a62.error!==undefined){throw(_a62)}_a59=_a62;gapi.client.setToken(_a59);await window.chatbotStorage.setAuthToken(_a59);console.log("âœ… Google Sign-In Successful! Token saved and set in GAPI client.",_a59);window.dispatchEvent(new CustomEvent('google-authed'))};if(_a59===null){_a52.requestAccessToken({prompt:'consent'})}else{google.accounts.oauth2.revoke(_a59.access_token);_a59=null;gapi.client.setToken(null);window.chatbotStorage.removeAuthToken();console.log("ðŸ”Œ Google Sign-Out Successful! Token removed from IndexedDB.");window.dispatchEvent(new CustomEvent('google-signed-out'))}}</script><script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script><script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script><script src='https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js'></script><script type="importmap">{"imports":{"react":"https://esm.sh/react@18.3.1","react-dom/client":"https://esm.sh/react-dom@18.3.1/client","@google/generative-ai":"https://esm.sh/@google/generative-ai@0.20.0"}}</script></head><body class="bg-gray-200"><div id="root"></div><script type="text/babel" data-type="module">import React,{useState,useEffect,useRef,useCallback,useMemo}from'react';import ReactDOM from'react-dom/client';import{GoogleGenerativeAI}from"@google/generative-ai";const _a63={dbName:'ApiKeyStatusDB',storeName:'deactivated_keys',async _a64(){return new Promise((_a65,_a66)=>{const _a67=indexedDB.open(this.dbName,1);_a67.onerror=()=>{_a66("Error opening DB")};_a67.onsuccess=()=>{_a65(_a67.result)};_a67.onupgradeneeded=_a68=>{const _a69=_a68.target.result;_a69.createObjectStore(this.storeName,{keyPath:'index'})}})},async _a70(){const _a71=await this._a64();return new Promise(_a72=>{const _a73=_a71.transaction(this.storeName,'readonly');const _a74=_a73.objectStore(this.storeName);const _a75=_a74.getAll();_a75.onsuccess=async()=>{const _a76=Date.now();const _a77=24*60*60*1000;const _a78=_a75.result.filter(_a79=>(_a76-_a79.timestamp)>_a77);for(const _a80 of _a78){await this._a81(_a80.index)}const _a82=_a75.result.filter(_a79=>(_a76-_a79.timestamp)<=_a77);_a72(_a82)}})},async _a83(_a84){const _a85=await this._a64();const _a86=_a85.transaction(this.storeName,'readwrite');const _a87=_a86.objectStore(this.storeName);_a87.put({index:_a84,timestamp:Date.now()})},async _a81(_a84){const _a85=await this._a64();const _a86=_a85.transaction(this.storeName,'readwrite');const _a87=_a86.objectStore(this.storeName);_a87.delete(_a84)}};let _a88=0;const _a89={USER:'user',AI:'ai'};const _a90={FRIEND:'Friend',PROFESSIONAL:'Professional'};const _a91={TAX_CONSULTANT:'Tax Consultant',GST_EXPERT:'GST Expert',STATUTORY_AUDITOR:'Statutory Auditor',INTERNAL_AUDITOR:'Internal Auditor',INVESTMENT_ADVISOR:'Investment Advisor',FINANCIAL_PLANNER:'Financial Planner',CORPORATE_ADVISOR:'Corporate Advisor',BANKING_EXPERT:'Banking Expert',INSURANCE_ADVISOR:'Insurance Advisor',MUTUAL_FUND_EXPERT:'Mutual Fund Expert',COMPANY_SECRETARY:'Company Secretary',COST_ACCOUNTANT:'Cost Accountant',FORENSIC_ACCOUNTANT:'Forensic Accountant',TRANSFER_PRICING_EXPERT:'Transfer Pricing Expert',IFRS_SPECIALIST:'IFRS Specialist',VALUATION_EXPERT:'Valuation Expert',COMPLIANCE_OFFICER:'Compliance Officer',RISK_MANAGEMENT_EXPERT:'Risk Management Expert',TREASURY_MANAGEMENT:'Treasury Management',EXPERT_ALL_FIELDS:'Expert in All Fields'};const _a92={MALE:'Male',FEMALE:'Female',OTHER:'Other'};const _a93={SINGLE:'single',GROUP:'group'};const _a94=(_a95,_a96,_a97=300000)=>{let _a98;return()=>{clearTimeout(_a98);_a98=setTimeout(async()=>{try{if(_a95==='userProfile'){await window.chatbotStorage.setUserProfile(_a96)}else if(_a95==='characters'){await window.chatbotStorage.setCharacters(_a96)}else if(_a95==='groups'){await window.chatbotStorage.setGroups(_a96)}console.log(`Saved ${_a95} after ${_a97/1000/60} min idle to IndexedDB.`)}catch(_a99){console.error(`Save failed for ${_a95}:`,_a99)}}, _a97)}};const _a100=(_a101)=>/tax|slab|income|fy \d{2}-\d{2}/i.test(_a101.toLowerCase());const _a102={Male:['01_CABOY.png','02_CABOY.jpg'],Female:['01_CAGIRL.png','02_CAGIRL.png'],Other:[]};const _a103=(_a104)=>{return _a104.map(_a105=>({role:_a105.sender===_a89.USER?'user':'model',parts:[{text:_a105.text}]}))};const _a106=async(_a107,_a108,_a109,_a110,_a111,_a112,_a113)=>{const _a114=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({history:_a103(_a109.slice(0,-1)),message:_a110.text,keyIndex:_a113,chatType:'single',character:_a107,userProfile:_a108})});return _a114};const _a115=async(_a116,_a108,_a117,_a110,_a111,_a118,_a112,_a113)=>{const _a119=_a117.slice(0,-1).map(_a105=>{const _a120=_a105.sender==='user'?_a108.name:_a116.find(_a121=>_a121.id===_a105.sender)?.name||'Unknown';return{role:'user',parts:[{text:`${_a120}: ${_a105.text}`}]}});const _a122=_a110.text.startsWith('[System:')?_a110.text:`User: ${_a110.text}\n\nContinue the group conversation following the rules and format exactly.`;const _a114=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({history:_a119,message:_a122,keyIndex:_a113,chatType:'group',userProfile:_a108,groupMembers:_a116,consecutiveSkips:_a118})});return _a114};const _a123=({userProfile:_a108,onSave:_a124,onCancel:_a125,isInitialSetup=false})=>{const [_a126,set_a126]=useState({..._a108,name:_a108.name||'Alex',age:_a108.age||25,gender:_a108.gender||_a92.MALE});const _a127=(e)=>{if(e.target.files&&e.target.files[0]){const _a128=e.target.files[0];const _a129=new FileReader();_a129.onload=(event)=>{if(event.target&&typeof event.target.result==='string'){set_a126(prev=>({...prev,avatar:event.target.result}))}}; _a129.readAsDataURL(_a128)}};const _a130=(e)=>{e.preventDefault();if(!_a126.name){alert("Please enter your name.");return}_a124(_a126)};return(<div className="flex flex-col h-full bg-blue-50"><header className="bg-blue-600 text-white p-4 pt-8 text-center"><h1 className="text-2xl font-bold">Virtual Chartered Accountants</h1><p className="text-sm opacity-90">First, let's set up your profile.</p></header><main className="flex-grow bg-white rounded-t-2xl p-4 overflow-y-auto"><form onSubmit={_a130} className="p-6 space-y-4"><h2 className="text-xl font-bold text-center text-gray-700">Your Profile</h2><div className="flex flex-col items-center space-y-2"><img src={_a126.avatar||`https://i.pravatar.cc/150?u=${_a126.id}`} alt="Your avatar" className="w-24 h-24 rounded-full object-cover border-2 border-gray-300"/><label className="cursor-pointer text-sm text-blue-600 hover:underline">Change Picture<input type="file" accept="image/*" onChange={_a127} className="hidden"/></label></div><div><label className="block text-sm font-medium text-gray-700 text-center">Or select a default avatar:</label><div className="mt-2 flex flex-wrap justify-center gap-2">{[..._a102['Male'],..._a102['Female'],..._a102['Other']].map((_a131,_a132)=>(<img key={_a132} src={_a131} alt={`Avatar ${_a132+1}`} className={`w-16 h-16 rounded-full object-cover cursor-pointer border-4 ${ _a126.avatar===_a131?'border-blue-600':'border-gray-200'}`} onClick={()=>set_a126(prev=>({...prev,avatar:_a131}))}/>))}</div></div><div><label className="block text-sm font-medium text-gray-700">Your Name *</label><input type="text" value={_a126.name} onChange={(e)=>set_a126({..._a126,name:e.target.value})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Alex" required/></div><div><label className="block text-sm font-medium text-gray-700">Age (Optional)</label><input type="number" value={_a126.age||''} onChange={(e)=>set_a126({..._a126,age:parseInt(e.target.value)||null})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="25"/></div><div><label className="block text-sm font-medium text-gray-700">Gender</label><select value={_a126.gender||''} onChange={(e)=>set_a126({..._a126,gender:e.target.value})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"><option value="">Select Gender (Optional)</option>{Object.values(_a92).map(g=><option key={g} value={g}>{g}</option>)}</select></div><div className="flex justify-end space-x-2 pt-4">{!isInitialSetup&&<button type="button" onClick={_a125} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancel</button>}<button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">{isInitialSetup?"Save Profile":"Save Profile"}</button></div></form></main></div>)};const _a133=({fileType})=>{let _a134=<path fillRule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clipRule="evenodd"/>;if(fileType.includes('pdf')){_a134=<path fillRule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v12H5V4zm2 2a1 1 0 00-1 1v1a1 1 0 102 0V7a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0V7a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0V7a1 1 0 00-1-1zm-6 5a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1zm3 0a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1z" clipRule="evenodd"/>}else if(fileType.includes('spreadsheet')||fileType.includes('excel')||fileType.includes('csv')){_a134=<path fillRule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v2H5V4zm0 4h10v2H5V8zm0 4h10v2H5v-2z" clipRule="evenodd"/>}else if(fileType.includes('word')){_a134=<path fillRule="evenodd" d="M5 2a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2H5zm0 2h10v2H5V4zm0 4h10v2H5V8zm0 4h10v2H5v-2z" clipRule="evenodd"/>}return(<svg className="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">{_a134}</svg>)};const _a135=({onSend:_a136,onSkip:_a137,isBlocked})=>{const [_a138,set_a138]=useState('');const [_a139,set_a139]=useState([]);const _a140=useRef(null);const _a141=()=>{const _a142=_a139.filter(_a143=>_a143.status==='ready');if(_a138.trim()||_a142.length>0){_a136(_a138.trim(),_a142);set_a138('');set_a139([])}};const _a144=(event)=>{const _a145=Array.from(event.target.files);const _a146=['application/vnd.ms-excel','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','text/csv','text/plain','application/json','text/html','application/pdf','application/msword','application/vnd.openxmlformats-officedocument.wordprocessingml.document','image/jpeg','image/jpg','image/png','image/gif','image/webp'];const _a147=_a145.filter(_a148=>{const _a149=_a146.includes(_a148.type)||_a148.name.toLowerCase().match(/\.(xlsx?|csv|txt|json|html?|pdf|docx?|jpe?g|png|gif|webp)$/i);if(!_a149){alert(`File "${_a148.name}" is not supported.`)}return _a149&&_a148.size<=50*1024*1024});if(_a147.length>0){const _a150=_a147.map(_a148=>{const _a151=Date.now()+Math.random();set_a139(prev=>[...prev,{id:_a151,name:_a148.name,size:_a148.size,type:_a148.type,status:'reading',preview:null}]);return{file:_a148,fileId:_a151}});_a150.forEach(({file:_a148,fileId:_a151})=>{const _a152=new Promise((_a153,_a154)=>{const _a155=_a148.name.toLowerCase().match(/\.(xlsx?)$/i);const _a156=_a148.type==='application/pdf';const _a157=_a148.type==='application/vnd.openxmlformats-officedocument.wordprocessingml.document'||_a148.name.toLowerCase().endsWith('.docx');const _a158=_a148.type.startsWith('image/');const _a159=new FileReader();if(_a155){_a159.onload=(e)=>{try{const _a160=XLSX.read(new Uint8Array(e.target.result),{type:'array'});let _a161='';_a160.SheetNames.forEach(_a162=>{ _a161+=`\n\n--- Sheet: ${_a162} ---\n\n`;const _a163=_a160.Sheets[_a162];const _a164=XLSX.utils.sheet_to_csv(_a163);_a161+=_a164});_a153({content:_a161,type:'text/csv'})}catch(err){_a154(err)}};_a159.readAsArrayBuffer(_a148)}else if(_a156){_a159.onload=async(e)=>{try{const _a165=await pdfjsLib.getDocument({data:new Uint8Array(e.target.result)}).promise;let _a166='';for(let i=1;i<=_a165.numPages;i++){const _a167=await _a165.getPage(i);const _a168=await _a167.getTextContent();_a166+=_a168.items.map(_a169=>_a169.str).join(' ')+'\n'}_a153({content:_a166,type:_a148.type})}catch(err){_a154(err)}};_a159.readAsArrayBuffer(_a148)}else if(_a157){_a159.onload=async(e)=>{try{const _a170=await mammoth.extractRawText({arrayBuffer:e.target.result});_a153({content:_a170.value,type:_a148.type})}catch(err){_a154(err)}};_a159.readAsArrayBuffer(_a148)}else if(_a158){_a159.onload=async(e)=>{try{const _a171=await Tesseract.recognize(e.target.result,'eng');_a153({content:_a171.data.text,preview:e.target.result})}catch(err){_a154(err)}};_a159.readAsDataURL(_a148)}else{_a159.onload=(e)=>_a153({content:e.target.result,type:_a148.type});_a159.readAsText(_a148)}});_a152.then(_a172=>{set_a139(prev=>prev.map(_a143=>_a143.id===_a151?{..._a143,status:'ready',content:_a172.content,preview:_a172.preview||_a143.preview,type:_a172.type||_a143.type}:_a143))}).catch(_a173=>{console.error('Error reading file:',_a148.name,_a173);set_a139(prev=>prev.map(_a143=>_a143.id===_a151?{..._a143,status:'error'}:_a143))})});event.target.value=''};const _a174=(_a151)=>{set_a139(prev=>prev.filter(_a143=>_a143.id!==_a151))};const _a175=(bytes)=>{if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i]};return(<footer className="chat-footer bg-white border-t border-gray-300">{_a139.length>0&&<div className="p-3 border-b border-gray-200 bg-gray-50"><div className="flex flex-wrap gap-2 max-h-32 overflow-y-auto">{_a139.map(_a143=>(<div key={_a143.id} className="relative bg-white border border-gray-300 rounded-lg p-2 flex items-center gap-2 max-w-xs">{_a143.preview?<img src={_a143.preview} alt={_a143.name} className="w-8 h-8 object-cover rounded"/>:<div className={`w-8 h-8 rounded flex items-center justify-center ${_a143.status==='error'?'bg-red-500':'bg-blue-500'}`}><_a133 fileType={_a143.type}/></div>}<div className="flex-1 min-w-0"><div className="text-xs font-medium text-gray-900 truncate">{_a143.name}</div><div className="text-xs text-gray-500">{_a175(_a143.size)}</div></div><div className="w-5 h-5 flex items-center justify-center">{_a143.status==='reading'&&<div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>}{_a143.status==='ready'&&<svg className="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"/></svg>}{_a143.status==='error'&&<svg className="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd"/></svg>}</div><button onClick={()=>_a174(_a143.id)} className="p-1 hover:bg-gray-200 rounded-full transition-colors"><svg className="w-3 h-3 text-gray-500" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd"/></svg></button></div>))}</div></div>}<div className="p-3 flex items-center gap-3"><input type="file" ref={_a140} onChange={_a144} multiple accept=".xlsx,.xls,.csv,.txt,.json,.html,.htm,.pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.webp" className="hidden"/><button onClick={()=>_a140.current?.click()} className="p-2 text-gray-400 hover:text-gray-600 transition-colors" disabled={isBlocked}><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/></svg></button><div className="flex-grow"><input type="text" value={_a138} onChange={(e)=>set_a138(e.target.value)} onKeyPress={(e)=>e.key==='Enter'&&_a141()} placeholder={isBlocked?"You are blocked":"Message..."} className="w-full px-4 py-3 bg-gray-100 border border-transparent rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500" disabled={isBlocked}/></div>{_a137&&<button onClick={_a137} className="p-2 text-white bg-gray-600 hover:bg-gray-700 rounded-full transition-colors" disabled={isBlocked}><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7"/></svg></button>}<button onClick={_a141} className={`p-3 text-white rounded-full transition-colors ${( _a138.trim()||_a139.some(_a143=>_a143.status==='ready'))&&!isBlocked?'bg-blue-600 hover:bg-blue-700':'bg-gray-400 cursor-not-allowed'}`} disabled={!( _a138.trim()||_a139.some(_a143=>_a143.status==='ready'))||isBlocked}><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/></svg></button></div></footer>)};const _a176=(_a177)=>{if(_a177.length<2)return null;const _a178=_a177[0].split('|').map(h=>h.trim()).filter(h=>h);const _a179=_a177.slice(2).map(line=>line.split('|').map(cell=>cell.trim()).filter(cell=>cell)).filter(row=>row.length>0&&row.some(cell=>cell.length>0));if(_a178.length>0&&_a179.length>0){return{headers:_a178,rows:_a179}}return null};const _a180=(_a181)=>{const _a182=[];const _a183=_a181.split('\n');let _a184=[];for(let i=0;i<_a183.length;i++){const line=_a183[i].trim();if(line.startsWith('|')&&line.endsWith('|')){if(_a184.length>0){_a182.push({type:'text',content:_a184.join('\n')});_a184=[]}const _a185=[];while(i<_a183.length&&_a183[i].trim().startsWith('|')&&_a183[i].trim().endsWith('|')){_a185.push(_a183[i]);i++}i--;const _a186=_a176(_a185);if(_a186){_a182.push({type:'table',data:_a186})}else{_a184.push(..._a185)}}else{_a184.push(_a183[i])}}if(_a184.length>0){_a182.push({type:'text',content:_a184.join('\n')})}return _a182};const _a187=({headers,rows})=>{const [_a188,set_a188]=React.useState(false);const _a189=()=>{let _a190=headers.join('\t')+'\n';_a190+=rows.map(row=>row.join('\t')).join('\n');navigator.clipboard.writeText(_a190).then(()=>{set_a188(true);setTimeout(()=>set_a188(false),2000)})};return(<div className="mt-2 text-sm text-gray-800"><div className="overflow-x-auto border border-gray-300 rounded-lg bg-gray-50"><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-100"><tr>{headers.map((_a191,_a192)=>(<th key={_a192} className="px-4 py-2 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">{_a191}</th>))}</tr></thead><tbody className="bg-white divide-y divide-gray-200">{rows.map((_a193,_a194)=>(<tr key={_a194} className={_a194%2===0?'bg-white':'bg-gray-50'}>{_a193.map((_a195,_a196)=>(<td key={_a196} className="px-4 py-2 whitespace-nowrap">{_a195}</td>))}</tr>))}</tbody></table></div><div className="flex justify-end mt-2"><button onClick={_a189} className={`fl items-center gap-1 px-3 py-1 text-xs rounded-full transition-colors ${ _a188?'bg-green-100 text-green-700':'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}>{_a188?'Copied!':'Copy Table'}</button></div></div>)};const _a197=({message,characterProfile,userProfile,characters,onEdit,onDelete})=>{const _a198=message.sender===_a89.USER;const [_a199,set_a199]=React.useState(false);const [_a200,set_a200]=React.useState(message.text);const [_a201,set_a201]=React.useState(false);const _a202=React.useRef(null);const _a203=()=>{if(onEdit){onEdit(message.id,_a200)}set_a199(false)};const _a204=()=>{set_a199(false);set_a200(message.text)};const _a205=(e)=>{e.preventDefault();if(_a198){set_a201(true)}};React.useEffect(()=>{const _a206=(event)=>{if(_a202.current&&!_a202.current.contains(event.target)){set_a201(false)}};document.addEventListener("mousedown",_a206);return()=>{document.removeEventListener("mousedown",_a206)}}, [_a202]);const _a207=_a198?userProfile:(characters&&characters.find(_a121=>_a121.id===message.sender))||characterProfile;const _a208=_a198?userProfile.avatar:_a207?.avatars?.[_a207?.activeAvatarIndex||0];const _a209=_a198?`https://i.pravatar.cc/150?u=${userProfile.id}`:`https://i.pravatar.cc/150?u=${_a207?.id}`;const _a210=_a198?null:_a207?.name;const _a211=(timestamp)=>{const date=new Date(timestamp);const hours=date.getHours().toString().padStart(2,'0');const minutes=date.getMinutes().toString().padStart(2,'0');return`${hours}:${minutes}`};const _a212=(text)=>{return text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')};const _a213=_a198?[{type:'text',content:message.text}]:_a180(message.text);const _a214=(bytes)=>{if(!bytes)return'';if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i]};return(<div className={`flex items-end gap-2 mb-1 ${_a198?'justify-end':'justify-start'}`}>{_a207&&<img src={_a208||_a209} alt={_a198?'Your avatar':_a207.name} className="w-8 h-8 rounded-full object-cover flex-shrink-0"/>}<div onContextMenu={_a205} className={`relative group ${_a213.some(_a215=>_a215.type==='table')?'max-w-full md:max-w-4xl':'max-w-sm md:max-w-md'}`}><div className={`px-4 py-3 rounded-2xl shadow-lg border ${_a198?'bg-gradient-to-r from-blue-500 to-blue-600 text-white border-blue-400':'bg-white text-gray-800 border-gray-200 shadow-md'}`}>{message.attachments&&message.attachments.length>0&&<div className="mb-2 space-y-2">{message.attachments.map(_a148=>(<div key={_a148.id} className={`p-2 rounded-lg flex items-center gap-3 ${_a198?'bg-blue-700/50':'bg-gray-100'}`}>{_a148.preview?<img src={_a148.preview} alt={_a148.name} className="w-10 h-10 object-cover rounded-md flex-shrink-0"/>:<div className={`w-10 h-10 rounded-md flex items-center justify-center flex-shrink-0 ${_a198?'bg-blue-500':'bg-gray-500'}`}><_a133 fileType={_a148.type}/></div>}<div className="flex-1 min-w-0"><p className={`text-sm font-medium truncate ${_a198?'text-white':'text-gray-800'}`}>{_a148.name}</p><p className={`text-xs ${_a198?'text-blue-100':'text-gray-500'}`}>{_a214(_a148.size)}</p></div></div>))}</div>}{_a199?<div className="space-y-2"><textarea value={_a200} onChange={(e)=>set_a200(e.target.value)} className="w-full p-2 border border-gray-300 rounded text-gray-800 resize-none" rows={3} autoFocus/><div className="flex gap-2"><button onClick={_a203} className="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">Save</button><button onClick={_a204} className="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">Cancel</button></div></div>:<>{_a213.map((_a215,_a132)=>{if(_a215.type==='table'){return(<_a187 key={_a132} headers={_a215.data.headers} rows={_a215.data.rows}/>)}else{if(_a215.content.trim()){return(<p key={_a132} className="whitespace-pre-wrap" dangerouslySetInnerHTML={{__html:_a212(_a215.content)}}/>)}return null}})}</>}<div className={`flex items-center justify-between mt-1 ${_a198?'text-blue-100':'text-gray-500'}`}>{!_a198&&_a210&&<span className="text-xs font-bold">{_a210}</span>}<div className="flex items-center"><span className="text-xs ml-2">{_a211(message.timestamp)}</span>{_a198&&<svg className="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>}</div></div></div>{_a201&&_a198&&<div ref={_a202} className="absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[120px]"><button onClick={(e)=>{e.stopPropagation();set_a199(true);set_a201(false)}} className="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>Edit</button><button onClick={(e)=>{e.stopPropagation();if(confirm('Are you sure you want to delete this message?')){onDelete&&onDelete(message.id)}set_a201(false)}} className="w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>Delete</button></div>}</div></div>)};const _a216=({messages,character,userProfile,characters,isTyping,backgroundUrl,streamingText='',onEditMessage,onDeleteMessage,isBlocked,blockCount,handleUnblock,characterName,groupName})=>{const _a217=useRef(null);const _a218='https://i.redd.it/qwd83nc4xxf41.jpg';useEffect(()=>{ _a217.current?.scrollIntoView({behavior:'smooth'})},[messages,isTyping]);const _a219={backgroundImage:`url('${backgroundUrl||_a218}')`,backgroundSize:'cover',backgroundPosition:'center'};const _a220=()=>{return messages.map((_a105)=> (<_a197 key={_a105.id} message={_a105} characterProfile={character} userProfile={userProfile} characters={characters} onEdit={onEditMessage} onDelete={onDeleteMessage}/>))};return(<main className="message-container" style={_a219}>{isBlocked&&<div className="sticky top-0 z-10 p-4"><div className="text-center p-4 bg-red-100 border border-red-400 text-red-700 rounded-md shadow-lg"><p className="font-bold">You are blocked by {characterName||groupName} ðŸ˜£</p><p className="text-sm">You have {3-blockCount} unblock attempt(s) remaining.</p><button onClick={handleUnblock} className="mt-2 px-4 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm">Request Unblock</button></div></div>}<div className="space-y-2 p-4">{_a220()}{isTyping&&<div className="flex justify-start items-end gap-2">{characters&&characters.length<=1&&<img src={character?.avatars?.[character?.activeAvatarIndex]||`https://i.pravatar.cc/150?u=${character?.id}`} alt="ai" className="w-8 h-8 rounded-full object-cover"/>}<div className={`bg-white rounded-2xl p-3 max-w-xs shadow ${characters&&characters.length>1?'ml-0':''}`}><div className="flex items-center justify-center space-x-1"><span className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-0"></span><span className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-150"></span><span className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-300"></span></div></div></div>}<div ref={_a217}/></div></main>)};const _a221=({isOpen,onClose,onSetBackground})=>{const _a222=useRef(null);if(!isOpen)return null;const _a223=(e)=>{if(e.target.files&&e.target.files[0]){const _a148=e.target.files[0];const _a129=new FileReader();_a129.onload=(event)=>{if(event.target&&typeof event.target.result==='string'){onSetBackground(event.target.result)}};_a129.readAsDataURL(_a148)}onClose()};return(<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg p-6 w-full max-w-md"><h3 className="text-lg font-bold mb-4">Background Settings</h3><div className="mb-4"><label className="block text-sm font-medium text-gray-700 mb-2">Upload Background Image</label><button onClick={()=>_a222.current?.click()} className="w-full py-2 px-4 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50">Choose file</button><input type="file" ref={_a222} accept="image/*" onChange={_a223} className="hidden"/><p className="text-xs text-gray-500 mt-1">Max size: 10MB</p></div><div className="flex justify-end space-x-2"><button onClick={onClose} className="py-2 px-4 text-gray-600 hover:text-gray-800">Cancel</button><button onClick={()=>_a222.current?.click()} className="py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save Background</button></div></div></div>)};const _a224=({character,onBack,onEditAiProfile,onEditUserProfile,onClearChat,onSetBackground})=>{const [_a225,set_a225]=useState(false);return(<><header className="fixed-header bg-blue-600 text-white p-3 flex items-center shadow-md"><button onClick={onBack} className="p-2 rounded-full hover:bg-white/20"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg></button><div className="flex items-center ml-2 cursor-pointer flex-grow" onClick={onEditAiProfile}><img src={character.avatars[character.activeAvatarIndex]||`https://i.pravatar.cc/150?u=${character.id}`} alt={character.name} className="w-10 h-10 rounded-full object-cover"/><div className="ml-3"><h2 className="font-semibold text-lg">{character.name}</h2><p className="text-sm opacity-90">{character.actLike} â€¢ {character.expertise.includes('Tax Consultant')?'Tax Consultant':character.expertise[0]||'General CA'}</p></div></div><div className="flex items-center space-x-1"><button onClick={()=>set_a225(true)} className="p-2 rounded-full hover:bg-white/20" title="Background"><span className="text-xl">ðŸŽ¨</span></button><button onClick={onEditUserProfile} className="p-2 rounded-full hover:bg-white/20" title="Profile"><span className="text-xl">ðŸ‘¤</span></button><button onClick={onClearChat} className="p-2 rounded-full hover:bg-white/20" title="Clear Chat"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></header><_a221 isOpen={_a225} onClose={()=>set_a225(false)} onSetBackground={onSetBackground}/></>)};const _a226=({initialCharacter,onSave,onCancel})=>{const _a227=()=>{const _a228=initialCharacter.avatars?.length>0;const _a229=_a228?initialCharacter.avatars:[..._a102['Male'],..._a102['Female'],..._a102['Other']];let _a230=0;if(_a228){_a230=initialCharacter.activeAvatarIndex}else if(initialCharacter.defaultAvatar){const _a231=_a229.indexOf(initialCharacter.defaultAvatar);if(_a231!==-1){_a230=_a231}}return{...initialCharacter,name:initialCharacter.name||(initialCharacter.gender==='Female'?'Tax Dost':initialCharacter.gender==='Male'?'Tax Dost':''),avatars:_a229,activeAvatarIndex:_a230,blockCount:initialCharacter.blockCount||0,isBlocked:initialCharacter.isBlocked||false}};const [_a232,set_a232]=useState(_a227());const _a233=(e)=>{if(e.target.files){const _a145=Array.from(e.target.files);_a145.forEach(_a148=>{const _a129=new FileReader();_a129.onload=(event)=>{if(event.target&&typeof event.target.result==='string'){set_a232(prev=>({...prev,avatars:[...prev.avatars,event.target.result]}))}}; _a129.readAsDataURL(_a148)})}};const _a234=(_a235)=>{set_a232(prev=>{const _a236=prev.expertise||[];if(_a236.includes(_a235)){return{...prev,expertise:_a236.filter(e=>e!==_a235)}}else{return{...prev,expertise:[..._a236,_a235]}}})};const _a237=(gender)=>{const _a238=gender==='Female'?'Tax Dost':gender==='Male'?'Tax Dost':_a232.name;set_a232(prev=>({...prev,gender,name:prev.name||_a238,activeAvatarIndex:0}))};const _a239=(e)=>{e.preventDefault();if(_a232.name.trim()===''){alert("Please enter a name for the character.");return}if(_a232.expertise.length===0&&!_a232.customPersonality){alert("Please select at least one expertise area or add custom expertise & behaviour.");return}onSave(_a232)};return(<form onSubmit={_a239} className="p-4 space-y-4"><div className="flex items-center justify-between mb-4"><h2 className="text-xl font-bold text-center text-gray-700">AI Character Profile</h2><button type="button" onClick={onCancel} className="text-gray-500 hover:text-gray-700"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg></button></div><div className="flex flex-col items-center space-y-3"><img src={_a232.avatars?.[_a232.activeAvatarIndex]||`https://i.pravatar.cc/150?u=${_a232.id}`} alt="Character avatar" className="w-24 h-24 rounded-full object-cover border-4 border-blue-200"/><div><label className="cursor-pointer text-sm text-blue-600 hover:underline">Choose file<input type="file" multiple accept="image/*" onChange={_a233} className="hidden"/></label><p className="text-xs text-gray-500 mt-1">No file chosen</p></div></div><div><label className="block text-sm font-medium text-gray-700 mb-2">Additional Images (Max 5)</label><input type="file" multiple accept="image/*" onChange={_a233} className="hidden" id="additional-images"/><label htmlFor="additional-images" className="cursor-pointer text-sm text-blue-600 hover:underline">Choose file</label><p className="text-xs text-gray-500 mt-1">No file chosen</p>{_a232.avatars?.length>0&&<div className="mt-2 flex flex-wrap gap-2">{_a232.avatars.map((_a131,_a132)=>(<img key={_a132} src={_a131} alt={`Avatar ${_a132+1}`} className={`w-12 h-12 rounded-lg object-cover cursor-pointer border-2 ${_a232.activeAvatarIndex===_a132?'border-blue-600':'border-gray-200'}`} onClick={()=>set_a232(prev=>({...prev,activeAvatarIndex:_a132}))}/>))}</div>}</div><div><label className="block text-sm font-medium text-gray-700">Name *</label><input type="text" value={_a232.name} onChange={(e)=>set_a232({..._a232,name:e.target.value})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="An" required/></div><div><label className="block text-sm font-medium text-gray-700">Age</label><input type="number" value={_a232.age} onChange={(e)=>set_a232({..._a232,age:parseInt(e.target.value)||18})} min="13" max="100" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="25" required/></div><div><label className="block text-sm font-medium text-gray-700">Gender</label><select value={_a232.gender} onChange={(e)=>_a237(e.target.value)} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">{Object.values(_a92).map(g=><option key={g} value={g}>{g}</option>)}</select></div><div><label className="block text-sm font-medium text-gray-700">Act Like</label><select value={_a232.actLike} onChange={(e)=>set_a232({..._a232,actLike:e.target.value})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">{Object.values(_a90).map(a=><option key={a} value={a}>{a}</option>)}</select></div><div><label className="block text-sm font-medium text-gray-700 mb-2">Expert</label><div className="flex flex-wrap gap-2">{Object.values(_a91).map(e=>(<button key={e} type="button" onClick={()=>_a234(e)} className={`px-3 py-2 rounded-full text-sm font-medium transition-colors ${_a232.expertise?.includes(e)?'bg-blue-600 text-white':'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>{e.replace(/_/g,' ')}</button>))}</div><p className="text-xs text-gray-500 mt-2">Select expertise areas for your CA. Multiple selections allowed.</p></div><div><label className="block text-sm font-medium text-gray-700">Custom Expertise & Behaviour (Optional)</label><textarea value={_a232.customPersonality||''} onChange={(e)=>set_a232({..._a232,customPersonality:e.target.value})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" rows={3} placeholder="Describe specific expertise not listed above or preferred behavior style (e.g., 'Short answers in bullet points', 'Detailed explanations with examples', 'Focus on practical applications')"/></div><div className="flex justify-end space-x-2 pt-4"><button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancel</button><button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Save Profile</button></div></form>)};const _a240=({characters,onSave,onCancel})=>{const [_a241,set_a241]=useState({id:`group_${Date.now()}`,name:'',members:[],messages:[],blockCount:0,isBlocked:false});const _a242=(_a243)=>{set_a241(prev=>{const _a244=prev.members.includes(_a243)?prev.members.filter(id=>id!==_a243):[...prev.members,_a243];return{...prev,members:_a244}})};const _a239=(e)=>{e.preventDefault();if(_a241.name.trim()===''){alert("Please enter a name for the group.");return}if(_a241.members.length===0){alert("Please select at least one AI profile for the group.");return}onSave(_a241)};return(<form onSubmit={_a239} className="p-4 space-y-4"><div className="flex items-center justify-between mb-4"><h2 className="text-xl font-bold text-center text-gray-700">Create Group Chat</h2><button type="button" onClick={onCancel} className="text-gray-500 hover:text-gray-700"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg></button></div><div><label className="block text-sm font-medium text-gray-700">Group Name</label><input type="text" value={_a241.name} onChange={(e)=>set_a241({..._a241,name:e.target.value})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="E.g., Friends Group" required/></div><div><label className="block text-sm font-medium text-gray-700">Select AI Profiles</label><div className="mt-1 space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-2">{characters.map(char=>(<label key={char.id} className="flex items-center space-x-2 cursor-pointer"><input type="checkbox" checked={_a241.members.includes(char.id)} onChange={()=>_a242(char.id)} className="rounded text-blue-600 focus:ring-blue-500"/><span className="text-sm text-gray-700">{char.name} ({char.relationship})</span></label>))}</div></div><div className="flex justify-end space-x-2 pt-4"><button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancel</button><button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Create Group</button></div></form>)};const _a245=({group,characters,onSave,onCancel})=>{const [_a246,set_a246]=useState({...group,blockCount:group.blockCount||0,isBlocked:group.isBlocked||false});const _a242=(_a243)=>{set_a246(prev=>{const _a244=prev.members.includes(_a243)?prev.members.filter(id=>id!==_a243):[...prev.members,_a243];return{...prev,members:_a244}})};const _a239=(e)=>{e.preventDefault();if(_a246.name.trim()===''){alert("Please enter a name for the group.");return}if(_a246.members.length===0){alert("Please select at least one AI profile for the group.");return}onSave(_a246)};return(<form onSubmit={_a239} className="p-4 space-y-4"><div className="flex items-center justify-between mb-4"><h2 className="text-xl font-bold text-center text-gray-700">Edit Group Chat</h2><button type="button" onClick={onCancel} className="text-gray-500 hover:text-gray-700"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg></button></div><div><label className="block text-sm font-medium text-gray-700">Group Name</label><input type="text" value={_a246.name} onChange={(e)=>set_a246({..._a246,name:e.target.value})} className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="E.g., Friends Group" required/></div><div><label className="block text-sm font-medium text-gray-700">Members</label><div className="mt-1 space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-2">{characters.map(char=>(<label key={char.id} className="flex items-center space-x-2 cursor-pointer"><input type="checkbox" checked={_a246.members.includes(char.id)} onChange={()=>_a242(char.id)} className="rounded text-blue-600 focus:ring-blue-500"/><span className="text-sm text-gray-700">{char.name} ({char.relationship})</span></label>))}</div></div><div className="flex justify-end space-x-2 pt-4"><button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancel</button><button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Save</button></div></form>)};const _a247=({isOpen,onClose,characters,groups,onSelectCharacter,onSelectGroup,showIndividual,setShowIndividual})=>{if(!isOpen)return null;return(<><div className="fixed inset-0 bg-black bg-opacity-50 z-40" onClick={onClose}></div><div className="fixed left-0 top-0 h-full w-80 bg-white z-50 shadow-lg transform transition-transform"><div className="p-4 border-b"><div className="flex items-center justify-between mb-4"><h2 className="text-lg font-bold">Chat History</h2><button onClick={onClose} className="text-gray-500 hover:text-gray-700"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg></button></div><div className="flex bg-gray-100 rounded-lg p-1"><button onClick={()=>setShowIndividual(true)} className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${ showIndividual?'bg-white text-blue-600 shadow-sm':'text-gray-600'}`}>Individual</button><button onClick={()=>setShowIndividual(false)} className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${ !showIndividual?'bg-white text-blue-600 shadow-sm':'text-gray-600'}`}>Group</button></div></div><div className="p-4 overflow-y-auto h-full">{showIndividual?<div className="space-y-2">{characters.map(char=>(<div key={char.id} onClick={()=>{onSelectCharacter(char.id);onClose()}} className="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100"><img src={char.avatars?.[char.activeAvatarIndex]||`https://i.pravatar.cc/150?u=${char.id}`} alt={char.name} className="w-10 h-10 rounded-full object-cover"/><div className="ml-3"><p className="font-semibold text-gray-800">{char.name}</p><p className="text-sm text-gray-600">{char.relationship}</p></div></div>))}</div>:<div className="space-y-2">{groups.map(group=>(<div key={group.id} onClick={()=>{onSelectGroup(group.id);onClose()}} className="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100"><div className="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center"><span className="text-blue-800 font-semibold">{group.name[0]}</span></div><div className="ml-3"><p className="font-semibold text-gray-800">{group.name}</p><p className="text-sm text-gray-600">Group ({group.members.length} members)</p></div></div>))}</div>}</div></div></>)};const _a248=({character,userProfile,onCharacterUpdate,onBack,onUserProfileUpdate,backgroundUrl,onSetBackground})=>{const _a249=3;const [_a250,set_a250]=useState(character.messages);const [_a251,set_a251]=useState(false);const [_a252,set_a252]=useState(false);const [_a253,set_a253]=useState(false);const [_a254,set_a254]=useState(character.blockCount||0);const [_a255,set_a255]=useState(character.isBlocked||false);const _a256=useRef(_a250);_a256.current=_a250;useEffect(()=>{onCharacterUpdate({...character,messages:_a250,blockCount:_a254,isBlocked:_a255})},[_a250,_a254,_a255]);const _a257=useCallback(async(_a138,_a258=[])=>{if(_a255)return;const _a259={id:`msg_${Date.now()}`,sender:_a89.USER,text:_a138,attachments:_a258,timestamp:Date.now()};let _a260=_a138;if(_a258&&_a258.length>0){const _a261=_a258.map(_a148=>{if(_a148.type.startsWith('text/')||_a148.type.includes('json')||_a148.type.includes('csv')||_a148.type.includes('pdf')||_a148.type.includes('wordprocessingml.document')||_a148.type.startsWith('image/')){return`\n\n--- Attached File: ${_a148.name} ---\n${_a148.content}\n--- End of File ---`}return''}).join('');_a260+=_a261}const _a262={..._a259,text:_a260};const _a263=[..._a256.current,_a259];set_a250(_a263);set_a251(true);const _a264=`msg_${Date.now()+1}`;set_a250(prev=>[...prev,{id:_a264,sender:_a89.AI,text:'',timestamp:Date.now()}]);const _a265=(_a266)=>{set_a250(prev=>prev.map(_a105=>_a105.id===_a264?{..._a105,text:_a105.text+(_a105.text.endsWith('\n\nSomething went wrong. Please retry.')?'':_a266)}:_a105))};let _a267=false;let _a268=0;while(!_a267&&_a268<_a249){const _a269=await _a63._a70();if(_a269.some(_a79=>_a79.index===_a268)){console.log(`Key index ${_a268} is on cooldown. Skipping.`);_a268++;continue}try{const _a114=await _a106(character,userProfile,_a263,_a262,_a265,()=>{},_a268);if(_a114.status===429){const _a270=await _a114.json();throw{name:'QuotaError',failedIndex:_a270.failedKeyIndex}}if(!_a114.ok){throw new Error(`Server error: ${_a114.statusText}`)}_a267=true;_a88=_a268;const _a271=_a114.body.getReader();const _a272=new TextDecoder();let _a273='';while(true){const{done,value}=await _a271.read();if(done)break;const _a266=_a272.decode(value,{stream:true});_a273+=_a266;_a265(_a266)}if(_a273.trim()==='[BLOCK_USER]'){_a254(prev=>prev+1);set_a255(true);set_a250(prev=>prev.filter(_a105=>_a105.id!==_a264))}}catch(_a274){if(_a274.name==='QuotaError'){console.warn(`Key at index ${_a274.failedIndex} failed. Deactivating and trying next.`);await _a63._a83(_a274.failedIndex);_a268++}else{console.error("A non-quota error occurred:",_a274);_a265("\n\nSomething went wrong. Please retry.");break}}}if(!_a267){console.error("All API keys failed or were on cooldown.");set_a250(prev=>prev.map(_a105=>_a105.id===_a264&&_a105.text===''?{..._a105,text:"All services are currently busy. Please try again later."}:_a105))}set_a251(false)},[character,userProfile,_a255]);const [_a275,set_a275]=useState([]);const _a276=(_a277,_a278)=>{const _a279=_a250.map(_a105=>_a105.id===_a277?{..._a105,text:_a278}:_a105);set_a250(_a279)};const _a280=(_a277)=>{const _a279=_a250.filter(_a105=>_a105.id!==_a277);set_a250(_a279);set_a275(prev=>prev.filter(id=>id!==_a277))};const _a281=(_a277)=>{set_a275(prev=>prev.includes(_a277)?prev.filter(id=>id!==_a277):[...prev,_a277])};const _a282=(_a277)=>{set_a275(prev=>prev.includes(_a277)?prev:[...prev,_a277])};const _a283=()=>{if(_a275.length>0&&confirm(`Delete ${_a275.length} selected message(s)?`)){const _a279=_a250.filter(_a105=>!_a275.includes(_a105.id));set_a250(_a279);set_a275([])}};const _a284=()=>{if(_a254>=3){alert("You have been blocked permanently. This chat will be deleted.");setCharacters(prev=>prev.filter(c=>c.id!==character.id));setGroups(prev=>prev.map(g=>({...g,members:g.members.filter(memberId=>memberId!==character.id)})));onBack();return}set_a255(false)};const _a285=()=>{if(window.confirm("Are you sure you want to delete all messages in this chat?")){set_a250([]);set_a254(0);set_a255(false)}};const _a286=(_a287)=>{onCharacterUpdate({..._a287,messages:_a250,_a254,_a255});set_a252(false)};const _a288=(_a108)=>{onUserProfileUpdate(_a108);set_a253(false)};return(<div className="app-container w-full bg-gray-100"><_a224 character={character} onBack={onBack} onEditAiProfile={()=>set_a252(true)} onEditUserProfile={()=>set_a253(true)} onClearChat={_a285} onSetBackground={onSetBackground}/>{_a275.length>0&&<div className="fixed top-20 left-4 right-4 bg-white border border-gray-300 rounded-lg shadow-lg p-3 z-20 flex justify-between items-center"><span className="text-sm font-medium">{_a275.length} message(s) selected</span><div className="flex gap-2"><button onClick={()=>set_a275([])} className="px-3 py-1 text-sm bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button><button onClick={_a283} className="px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600">Delete</button></div></div>}<_a216 messages={_a250} character={character} userProfile={userProfile} characters={characters} isTyping={_a251} backgroundUrl={backgroundUrl} onEditMessage={_a276} onDeleteMessage={_a280} selectedMessages={_a275} onSelectMessage={_a281} onLongPressMessage={_a282} isBlocked={_a255} blockCount={_a254} characterName={character.name} handleUnblock={_a284}/><_a135 onSend={_a257} isBlocked={_a255}/>{_a252&&<div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"><_a226 initialCharacter={{...character,_a254,_a255}} onSave={_a286} onCancel={()=>set_a252(false)}/></div></div>}{_a253&&<div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"><UserProfileSetup userProfile={userProfile} onSave={_a288} onCancel={()=>set_a253(false)}/></div></div>}</div>)};const _a289=({group,characters,userProfile,onGroupUpdate,onBack,onUserProfileUpdate,backgroundUrl,onSetBackground})=>{const _a249=3;const [_a250,set_a250]=useState(group.messages||[]);const [_a251,set_a251]=useState(false);const [_a253,set_a253]=useState(false);const [_a290,set_a290]=useState(false);const [_a118,set_a118]=useState(0);const [_a254,set_a254]=useState(group.blockCount||0);const [_a255,set_a255]=useState(group.isBlocked||false);const _a256=useRef(_a250);useEffect(()=>{ _a256.current=_a250;},[_a250]);useEffect(()=>{onGroupUpdate({...group,messages:_a250,_a254,_a255})},[_a250,_a254,_a255]);const _a291=useMemo(()=>group.members.map(id=>characters.find(_a121=>_a121.id===id)).filter(Boolean), [group.members,characters]);const _a292=useCallback(async(_a293,_a138='',_a258=[])=>{if(_a255)return;const _a294=false;let _a260=_a138;if(!_a293&&_a258&&_a258.length>0){const _a261=_a258.map(_a148=>{if(_a148.type.startsWith('text/')||_a148.type.includes('json')||_a148.type.includes('csv')||_a148.type.includes('pdf')||_a148.type.includes('wordprocessingml.document')||_a148.type.startsWith('image/')){return`\n\n--- Attached File: ${_a148.name} ---\n${_a148.content}\n--- End of File ---`}return''}).join('');_a260+=_a261}let _a295;let _a262;if(_a293){let _a296=_a294?'[System: User is listening, continue naturally.]':'[System: User skipped. '+( _a118+1>=2?'User seems unavailable, continue among AIs.':'Continue conversation.')]';_a295={text:_a296}}else{_a295={id:`msg_${Date.now()}`,sender:_a89.USER,text:_a138,attachments:_a258,timestamp:Date.now()}} _a262={..._a295,text:_a260};let _a297=[..._a256.current];if(!_a293){_a297.push(_a295);set_a250(_a297)}set_a251(true);const _a298=_a293?_a118+1:0;set_a118(_a298);const _a299=`stream_${Date.now()}`;set_a250(prev=>[...prev,{id:_a299,sender:'group',text:'',timestamp:Date.now()}]);const _a265=(_a266)=>{set_a250(prev=>prev.map(_a105=>_a105.id===_a299?{..._a105,text:_a105.text+_a266}:_a105))};let _a267=false;let _a268=0;while(!_a267&&_a268<_a249){const _a269=await _a63._a70();if(_a269.some(_a79=>_a79.index===_a268)){console.log(`Key index ${_a268} is on cooldown for group chat. Skipping.`);_a268++;continue}try{const _a114=await _a115(_a291,userProfile,_a297,_a262,_a265,_a298,()=>{},_a268);if(_a114.status===429){const _a270=await _a114.json();throw{name:'QuotaError',failedIndex:_a270.failedKeyIndex}}if(!_a114.ok){throw new Error(`Server error: ${_a114.statusText}`)}_a267=true;_a88=_a268;const _a271=_a114.body.getReader();const _a272=new TextDecoder();let _a300='';while(true){const{done,value}=await _a271.read();if(done)break;const _a266=_a272.decode(value,{stream:true});_a300+=_a266}if(_a300.includes('[BLOCK_USER]')){set_a254(prev=>prev+1);set_a255(true);set_a250(prev=>prev.filter(_a105=>_a105.id!==_a299))}else{const _a301=[];const _a302=_a300.split('\n');const _a303=/^([\w\s]+):\s*(.*)/;_a302.forEach(line=>{const _a304=line.match(_a303);if(_a304){const _a305=_a304[1].trim();const _a306=_a304[2].trim();const _a121=_a291.find(c=>c.name===_a305);if(_a121){_a301.push({id:`msg_${Date.now()}_${Math.random()}`,sender:_a121.id,text:_a306,timestamp:Date.now()})}}else if(_a301.length>0&&line.trim().length>0){_a301[_a301.length-1].text+='\n'+line}});set_a250(prev=>[...prev.filter(_a105=>_a105.id!==_a299),..._a301.filter(_a105=>_a105.text)])} }catch(_a274){if(_a274.name==='QuotaError'){console.warn(`Key at index ${_a274.failedIndex} failed for group chat. Deactivating.`);await _a63._a83(_a274.failedIndex);_a268++}else{console.error("Group chat API error:",_a274);set_a250(prev=>prev.map(_a105=>_a105.id===_a299?{..._a105,text:"Something went wrong."}:_a105));break}}}if(!_a267){console.error("All API keys for group chat failed.");set_a250(prev=>prev.map(_a105=>_a105.id===_a299?{..._a105,text:"All services are currently busy. Please try again later."}:_a105))}set_a251(false)},[_a291,userProfile,_a118,_a255]);const _a136=(_a138,_a258=[])=>_a292(false,_a138,_a258);const _a137=()=>_a292(true);const _a284=()=>{if(_a254>=3){alert("You have been blocked permanently. This group chat will be deleted.");onBack();return}set_a255(false)};const _a285=()=>{if(window.confirm("Are you sure you want to delete all messages in this group chat?")){set_a250([]);set_a254(0);set_a255(false)}};const _a288=(_a108)=>{onUserProfileUpdate(_a108);set_a253(false)};const _a307=(_a308)=>{onGroupUpdate({..._a308,messages:_a250,_a254,_a255});set_a290(false)};const [_a275,set_a275]=useState([]);const _a276=(_a277,_a278)=>{const _a279=_a250.map(_a105=>_a105.id===_a277?{..._a105,text:_a278}:_a105);set_a250(_a279)};const _a280=(_a277)=>{const _a279=_a250.filter(_a105=>_a105.id!==_a277);set_a250(_a279);set_a275(prev=>prev.filter(id=>id!==_a277))};const _a281=(_a277)=>{set_a275(prev=>prev.includes(_a277)?prev.filter(id=>id!==_a277):[...prev,_a277])};const _a282=(_a277)=>{set_a275(prev=>prev.includes(_a277)?prev:[...prev,_a277])};const _a283=()=>{if(_a275.length>0&&confirm(`Delete ${_a275.length} selected message(s)?`)){const _a279=_a250.filter(_a105=>!_a275.includes(_a105.id));set_a250(_a279);set_a275([])}};return(<div className="app-container w-full bg-gray-100"><header className="fixed-header bg-blue-600 text-white p-3 flex items-center shadow-md"><button onClick={onBack} className="p-2 rounded-full hover:bg-white/20"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg></button><div className="ml-3 flex-grow"><h2 className="font-semibold text-lg">{group.name}</h2><p className="text-sm opacity-90">Group Chat â€¢ { _a291.length} members</p></div><div className="flex items-center gap-1"><button onClick={()=>set_a290(true)} className="p-2 text-white hover:bg-white/20 rounded"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg></button><button onClick={_a285} className="p-2 text-white hover:bg-white/20 rounded"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button><button onClick={()=>set_a253(true)} className="p-2 text-white hover:bg-white/20 rounded"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg></button></div></header>{_a275.length>0&&<div className="fixed top-20 left-4 right-4 bg-white border border-gray-300 rounded-lg shadow-lg p-3 z-20 flex justify-between items-center"><span className="text-sm font-medium">{_a275.length} message(s) selected</span><div className="flex gap-2"><button onClick={()=>set_a275([])} className="px-3 py-1 text-sm bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button><button onClick={_a283} className="px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600">Delete</button></div></div>}<_a216 messages={_a250} characters={characters} userProfile={userProfile} isTyping={_a251} backgroundUrl={backgroundUrl} onEditMessage={_a276} onDeleteMessage={_a280} selectedMessages={_a275} onSelectMessage={_a281} onLongPressMessage={_a282} isBlocked={_a255} blockCount={_a254} groupName={group.name} handleUnblock={_a284}/><_a135 onSend={_a136} onSkip={_a137} isBlocked={_a255}/>{_a253&&<div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"><UserProfileSetup userProfile={userProfile} onSave={_a288} onCancel={()=>set_a253(false)}/></div></div>}{_a290&&<div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"><_a245 group={group} characters={characters} onSave={_a307} onCancel={()=>set_a290(false)}/></div></div>}</div>)};const _a308=({isOpen,onClose})=>{if(!isOpen)return null;return(<div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-4xl h-[90vh] flex flex-col shadow-2xl overflow-hidden"><header className="flex items-center justify-between p-4 border-b"><h2 className="text-xl font-bold text-gray-800">App Guide & Instructions</h2><button onClick={onClose} className="p-2 text-gray-500 hover:text-gray-800 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg></button></header><div className="flex-grow overflow-y-auto"><iframe src="./instructions.html" className="w-full h-full border-0" title="Instructions"></iframe></div></div></div>)};const _a309=({characters,groups,onSelectCharacter,onSelectGroup,setCharacters,setGroups,setUserProfile,setChatBackground,userProfile,chatBackground,isGoogleAuthed,onLogout,onNavigateToUpdates})=>{const [_a310,set_a310]=useState(false);const [_a311,set_a311]=useState(false);const [_a312,set_a312]=useState(false);const [_a313,set_a313]=useState(false);const [_a314,set_a314]=useState(true);const [_a315,set_a315]=useState(false);const _a316=useRef(null);const _a317=(_a318)=>{setCharacters(prev=>[...prev,_a318]);set_a310(false)};const _a319=(_a320)=>{setGroups(prev=>[...prev,_a320]);set_a311(false);onSelectGroup(_a320.id)};const _a321=(e,_a322)=>{e.stopPropagation();if(window.confirm("Are you sure you want to delete this AI profile? This will also remove it from all group chats.")){setCharacters(prev=>prev.filter(c=>c.id!==_a322));setGroups(prev=>prev.map(g=>({...g,members:g.members.filter(memberId=>memberId!==_a322)})).filter(g=>g.members.length>0))}};const _a288=(_a108)=>{setUserProfile(_a108);set_a312(false)};const _a323=(e)=>{const _a148=e.target.files[0];if(_a148){const _a159=new FileReader();_a159.onload=(event)=>{try{const _a324=JSON.parse(event.target.result);if(_a324.userProfile){setUserProfile(_a324.userProfile)}if(_a324.characters){setCharacters(prev=>[...prev,..._a324.characters])}if(_a324.groups){setGroups(prev=>[...prev,..._a324.groups])}alert("Data imported successfully!")}catch(_a325){console.error("Import error:",_a325);alert("Failed to import data. Please check the file format.")}}; _a159.readAsText(_a148)}};const _a326=()=>{const _a327={userProfile,characters,groups};const _a328=new Blob([JSON.stringify(_a327,null,2)],{type:'application/json'});const _a329=URL.createObjectURL(_a328);const a=document.createElement('a');a.href=_a329;a.download='TaxFriend_data.json';a.click();URL.revokeObjectURL(_a329)};return(<><div className="flex flex-col h-full bg-blue-600"><header className="bg-blue-600 text-white p-4 pt-8 flex items-center justify-between"><div className="flex items-center gap-1"><button onClick={()=>set_a313(true)} className="p-2 hover:bg-white/20 rounded"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16"/></svg></button><button onClick={onLogout} className="p-2 hover:bg-white/20 rounded-full" title="Logout"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg></button></div><h1 className="text-xl font-bold">Virtual Chartered Accountants</h1><div className="flex items-center gap-2"><button onClick={_a61} className={`py-1 px-3 rounded-full text-xs font-semibold transition-colors ${ isGoogleAuthed?'bg-green-500 hover:bg-green-600 text-white':'bg-white hover:bg-gray-200 text-blue-600'}`}>{isGoogleAuthed?'Drive Connected':'Connect to Drive'}</button><button onClick={()=>set_a315(true)} className="p-2 rounded-full hover:bg-white/20" title="Instructions"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></button><button onClick={()=>set_a312(true)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center"><img src={userProfile.avatar||`https://i.pravatar.cc/150?u=${userProfile.id}`} alt="Profile" className="w-8 h-8 rounded-full object-cover"/></button></div></header><main className="flex-grow bg-white rounded-t-3xl p-4 overflow-y-auto"><div className="flex justify-between items-center mb-6"><h3 className="text-lg font-bold text-gray-700">Chats</h3><div className="flex gap-2"><button onClick={()=>set_a310(true)} className="py-2 px-3 bg-blue-600 text-white rounded-full text-sm hover:bg-blue-700">New AI</button><button onClick={()=>set_a311(true)} className="py-2 px-3 bg-blue-600 text-white rounded-full text-sm hover:bg-blue-700">New Group</button><button onClick={onNavigateToUpdates} className="py-2 px-3 bg-teal-600 text-white rounded-full text-sm hover:bg-teal-700">Latest Updates</button><button onClick={()=>_a316.current?.click()} className="py-2 px-3 bg-gray-600 text-white rounded-full text-sm hover:bg-gray-700">Import</button><input type="file" ref={_a316} accept=".json" onChange={_a323} className="hidden"/><button onClick={_a326} className="py-2 px-3 bg-gray-600 text-white rounded-full text-sm hover:bg-gray-700">Export</button></div></div>{characters.length===0&&groups.length===0?(<div className="flex flex-col items-center justify-center h-full"><div className="bg-blue-100 rounded-full p-4 mb-4"><svg xmlns="http://www.w3.org/2000/svg" className="h-12 w-12 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg></div><h2 className="text-xl text-gray-700">Hey! I'm Tax Dost</h2><p className="text-sm text-gray-500 text-center">Your personal Chartered Accountant. Ask me anything about tax, finance, or investments to get started! ðŸ’¼</p><button onClick={()=>set_a310(true)} className="mt-4 py-2 px-4 bg-blue-600 text-white rounded-full">+ New Chat</button></div>):(<div className="space-y-3">{characters.map(char=>(<div key={char.id} onClick={()=>onSelectCharacter(char.id)} className="flex items-center p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors"><img src={char.avatars?.[char.activeAvatarIndex]||`https://i.pravatar.cc/150?u=${char.id}`} alt={char.name} className="w-12 h-12 rounded-full object-cover"/><div className="ml-4 flex-grow"><div className="flex items-center justify-between"><p className="font-semibold text-gray-800">{char.name}</p><span className="text-xs text-gray-500">{char.messages?.length>0?new Date(char.messages[char.messages.length-1].timestamp).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'}):''}</span></div><div className="flex items-center justify-between mt-1"><p className="text-sm text-gray-600">{char.actLike} â€¢ {char.expertise[0]||'General CA'}</p><button onClick={(e)=>_a321(e,char.id)} className="p-1 text-red-400 hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></div></div>))}{groups.map(group=>(<div key={group.id} onClick={()=>onSelectGroup(group.id)} className="flex items-center p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors"><div className="w-12 h-12 rounded-full bg-blue-200 flex items-center justify-center"><span className="text-blue-800 font-semibold">{group.name[0]}</span></div><div className="ml-4 flex-grow"><div className="flex items-center justify-between"><p className="font-semibold text-gray-800">{group.name}</p><span className="text-xs text-gray-500">{group.messages?.length>0?new Date(group.messages[group.messages.length-1].timestamp).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'}):''}</span></div><div className="flex items-center justify-between mt-1"><p className="text-sm text-gray-600">Group ({group.members.length} members)</p><button onClick={(e)=>{e.stopPropagation();if(window.confirm("Are you sure you want to delete this group?")){setGroups(prev=>prev.filter(g=>g.id!==group.id))}}} className="p-1 text-red-400 hover:text-red-600"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></div></div>))}</div>)}</main></div><_a247 isOpen={_a313} onClose={()=>set_a313(false)} characters={characters} groups={groups} onSelectCharacter={onSelectCharacter} onSelectGroup={onSelectGroup} showIndividual={_a314} setShowIndividual={set_a314}/>{_a310&&<div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"><_a226 initialCharacter={{id:`char_${Date.now()}`,name:'',actLike:_a90.FRIEND,gender:_a92.FEMALE,age:25,expertise:[_a91.TAX_CONSULTANT],avatars:[],defaultAvatar:'01_CAGIRL.png',activeAvatarIndex:0,messages:[],customPersonality:'',blockCount:0,isBlocked:false}} onSave={_a317} onCancel={()=>set_a310(false)}/></div></div>}{_a311&&<div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"><_a240 characters={characters} onSave={_a319} onCancel={()=>set_a311(false)}/></div></div>}{_a312&&<div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"><UserProfileSetup userProfile={userProfile} onSave={_a288} onCancel={()=>set_a312(false)}/></div></div>}<_a308 isOpen={_a315} onClose={()=>set_a315(false)}/></>)};const _a330=({initialCard,onSave,onCancel})=>{const [_a331,set_a331]=useState(initialCard||{id:`card_${Date.now()}`,name:'',topic:'',description:'',emoji:'ðŸ“„'});const _a332=['ðŸ“„','ðŸ“…','ðŸ“ˆ','ðŸ’¡','ðŸ“°','ðŸ’¼','ðŸ“Š','ðŸ””'];const _a239=(e)=>{e.preventDefault();if(!_a331.name.trim()||!_a331.topic.trim()){alert("Card Name and Topic/Keywords are required.");return}onSave(_a331)};return(<div className="min-h-screen bg-gradient-to-br from-gray-500 via-gray-700 to-gray-900 flex items-center justify-center p-4"><div className="bg-white/90 backdrop-blur-sm rounded-xl shadow-2xl p-8 w-full max-w-md"><h1 className="text-3xl font-bold text-gray-800 mb-6 text-center">{initialCard?"Edit Update Card":"Create New Update Card"}</h1><form onSubmit={_a239} className="space-y-4"><div><label className="block text-sm font-medium text-gray-700">Card Name</label><input type="text" value={_a331.name} onChange={(e)=>set_a331({..._a331,name:e.target.value})} placeholder="e.g., My GST Tracker" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required/></div><div><label className="block text-sm font-medium text-gray-700">Topic / Keywords (for Google Search)</label><input type="text" value={_a331.topic} onChange={(e)=>set_a331({..._a331,topic:e.target.value})} placeholder="e.g., Latest GST notifications India" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500" required/></div><div><label className="block text-sm font-medium text-gray-700">Description (Optional)</label><textarea value={_a331.description} onChange={(e)=>set_a331({..._a331,description:e.target.value})} rows={3} placeholder="What does this card track?" className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/></div><div><label className="block text-sm font-medium text-gray-700">Select Icon</label><div className="flex flex-wrap gap-2 mt-2">{_a332.map(emoji=>(<button key={emoji} type="button" onClick={()=>set_a331({..._a331,emoji:emoji})} className={`text-2xl p-2 rounded-lg ${_a331.emoji===emoji?'bg-blue-500 ring-2 ring-blue-700':'bg-gray-200 hover:bg-gray-300'}`}>{emoji}</button>))}</div></div><div className="flex justify-end space-x-2 pt-4"><button type="button" onClick={onCancel} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancel</button><button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Save Card</button></div></form></div></div>)};const _a333=({card,onBack})=>{const [_a334,set_a334]=useState([]);const [_a335,set_a335]=useState(false);const [_a336,set_a336]=useState(null);const _a337=async()=>{set_a335(true);set_a336(null);set_a334([]);try{const _a268=_a88;const _a114=await fetch('/api/get-updates',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({topic:card.topic,keyIndex:_a268})});if(!_a114.ok){if(_a114.status===429){throw new Error("Quota exceeded for this API key. Please try again later.")}throw new Error(`Server error: ${_a114.statusText}`)}const _a338=await _a114.json();if(_a338.updates){set_a334(_a338.updates)}else{set_a336(_a338.error||"Failed to get updates.")}}catch(err){set_a336(err.message)}finally{set_a335(false)}};useEffect(()=>{ _a337()},[card]);return(<div className="app-container w-full bg-gray-100"><header className="fixed-header bg-blue-600 text-white p-3 flex items-center shadow-md"><button onClick={onBack} className="p-2 rounded-full hover:bg-white/20"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg></button><div className="ml-3 flex-grow"><h2 className="font-semibold text-lg">{card.emoji} {card.name}</h2><p className="text-sm opacity-90 truncate">{card.topic}</p></div><button onClick={_a337} disabled={_a335} className="p-2 rounded-full hover:bg-white/20 disabled:opacity-50" title="Refresh Updates"><svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${_a335?'animate-spin':''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0015.357 2m0 0H15"/></svg></button></header><main className="message-container p-4">{card.description&&<div className="p-3 bg-white rounded-lg shadow mb-4"><p className="text-sm text-gray-700 italic">{card.description}</p></div>}{_a335&&<div className="flex justify-center items-center h-32"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div><p className="ml-3 text-gray-600">Fetching latest updates...</p></div>}{_a336&&<div className="p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg"><p className="font-bold">Error:</p><p>{_a336}</p></div>}{!_a335&&!_a336&&_a334.length===0&&<div className="p-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg text-center"><p>No significant updates found for today.</p></div>}{!_a335&&!_a336&&_a334.length>0&&<div className="space-y-3">{_a334.map((_a339,_a132)=>(<div key={_a132} className="p-4 bg-white rounded-xl shadow-md flex items-start gap-3"><span className="text-blue-500 font-bold text-lg">{_a132+1}.</span><p className="text-gray-800">{_a339}</p></div>))}</div>}</main></div>)};const _a340=({cards,onNavigateBack,onNavigateToForm,onNavigateToView,onCardUpdate,onCardDelete})=>{const _a341=(e,_a342)=>{e.stopPropagation();onNavigateToForm(_a342)};const _a343=(e,_a344)=>{e.stopPropagation();if(window.confirm("Are you sure you want to delete this update card?")){onCardDelete(_a344)}};return(<div className="flex flex-col h-full bg-blue-600"><header className="bg-blue-600 text-white p-4 pt-8 flex items-center justify-between"><button onClick={onNavigateBack} className="p-2 hover:bg-white/20 rounded"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg></button><h1 className="text-xl font-bold">Latest Updates</h1><div className="w-10"></div></header><main className="flex-grow bg-white rounded-t-3xl p-4 overflow-y-auto">{cards.length===0?(<div className="flex flex-col items-center justify-center h-full"><div className="bg-blue-100 rounded-full p-4 mb-4"><svg xmlns="http://www.w3.org/2000/svg" className="h-12 w-12 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 12h6m-4-4h2"/></svg></div><h2 className="text-xl text-gray-700">Create your first Update Card</h2><p className="text-sm text-gray-500 text-center">Track daily news on topics that matter to you.</p><button onClick={()=>onNavigateToForm(null)} className="mt-4 py-2 px-4 bg-blue-600 text-white rounded-full">+ Create Card</button></div>):(<div className="space-y-3">{cards.map(_a342=>(<div key={_a342.id} onClick={()=>onNavigateToView(_a342)} className="flex items-center p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition-colors"><div className="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0"><span className="text-3xl">{_a342.emoji}</span></div><div className="ml-4 flex-grow min-w-0"><p className="font-semibold text-gray-800 truncate">{_a342.name}</p><p className="text-sm text-gray-600 truncate">{_a342.topic}</p></div><div className="flex-shrink-0 flex gap-1 ml-2"><button onClick={(e)=>_a341(e,_a342)} className="p-2 text-blue-500 hover:bg-blue-100 rounded-full" title="Edit Card"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg></button><button onClick={(e)=>_a343(e,_a342.id)} className="p-2 text-red-500 hover:bg-red-100 rounded-full" title="Delete Card"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></div>))}</div>)}{cards.length>0&&<button onClick={()=>onNavigateToForm(null)} className="fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700" title="Create New Card"><svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg></button>}</main></div>)};const _a344=({onConnect,onSkip})=>{return(<div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50"><div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center"><h2 className="text-xl font-bold text-gray-800 mb-4">Sync Your Data</h2><p className="text-gray-600 mb-6">Connect to Google Drive to securely back up and sync your chat history across devices.</p><div className="flex flex-col gap-3"><button onClick={onConnect} className="w-full py-3 px-4 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 transition-colors">Continue with Google Drive</button><button onClick={onSkip} className="w-full py-2 px-4 rounded-lg font-semibold text-gray-500 hover:bg-gray-200 transition-colors">Continue without Drive</button></div></div></div>)};const App=()=>{const [userProfile,setUserProfile]=useState({id:`user_${Date.now()}`,name:'Alex',age:25,gender:_a92.MALE,avatar:'01_CABOY.png'});const [characters,setCharacters]=useState([]);const [groups,setGroups]=useState([]);const [updateCards,setUpdateCards]=useState([]);const [isDataLoaded,setIsDataLoaded]=useState(false);const [loadingProgress,setLoadingProgress]=useState(0);const [chatBackground,setChatBackground]=useState(null);const [isGoogleAuthed,setIsGoogleAuthed]=useState(false);const [secretCode,setSecretCode]=useState(null);const [isAuthLoading,setIsAuthLoading]=useState(true);const [showDrivePrompt,setShowDrivePrompt]=useState(false);const [currentView,setCurrentView]=useState({screen:'chats'});const exportIntervalRef=useRef(null);const inactivityTimerRef=useRef(null);useEffect(()=>{const _a345=async()=>{try{console.log("Loading all data from IndexedDB...");setLoadingProgress(10);const _a346=await window.chatbotStorage.getUserProfile();if(_a346)setUserProfile(_a346);setLoadingProgress(25);const _a347=await window.chatbotStorage.getCharacters();if(_a347)setCharacters(_a347);setLoadingProgress(50);const _a348=await window.chatbotStorage.getGroups();if(_a348)setGroups(_a348);setLoadingProgress(75);const _a349=await window.chatbotStorage.getUpdateCards();if(_a349)setUpdateCards(_a349);setLoadingProgress(100);setTimeout(()=>setIsDataLoaded(true),500)}catch(_a350){console.error('Error loading data:',_a350);setIsDataLoaded(true)}};_a345()},[]);useEffect(()=>{const _a351=async()=>{let _a352=null;try{_a352=localStorage.getItem('temp_secret_code');if(_a352){localStorage.removeItem('temp_secret_code');if(window.chatbotStorage){await window.chatbotStorage.setSecretCode(_a352)}}else if(window.chatbotStorage){_a352=await window.chatbotStorage.getSecretCode()}if(_a352){console.log("Found saved secret code.");setSecretCode(_a352);setIsAuthLoading(false)}else{console.log("No secret code found. Redirecting to home");window.location.href='/'} }catch(_a350){console.error('Error loading secret code:',_a350);window.location.href='/'}} ;if(isDataLoaded){_a351()}else{setTimeout(_a351,200)}}, [isDataLoaded]);useEffect(()=>{if(isDataLoaded&&userProfile&&userProfile.id){window.chatbotStorage.setUserProfile(userProfile)}}, [userProfile,isDataLoaded]);useEffect(()=>{if(isDataLoaded&&characters){window.chatbotStorage.setCharacters(characters)}}, [characters,isDataLoaded]);useEffect(()=>{if(isDataLoaded&&groups){window.chatbotStorage.setGroups(groups)}}, [groups,isDataLoaded]);useEffect(()=>{if(isDataLoaded&&updateCards){window.chatbotStorage.setUpdateCards(updateCards)}}, [updateCards,isDataLoaded]);useEffect(()=>{const _a353=()=>setIsGoogleAuthed(true);const _a354=()=>setIsGoogleAuthed(false);window.addEventListener('google-authed',_a353);window.addEventListener('google-signed-out',_a354);return()=>{window.removeEventListener('google-authed',_a353);window.removeEventListener('google-signed-out',_a354)}}, []);useEffect(()=>{if(isGoogleAuthed&&secretCode){console.log("Google Auth is active. Starting import and auto-export interval.");_a355();if(exportIntervalRef.current)clearInterval(exportIntervalRef.current);exportIntervalRef.current=setInterval(_a356,30000);return()=>{if(exportIntervalRef.current)clearInterval(exportIntervalRef.current)}}}, [isGoogleAuthed,secretCode]);useEffect(()=>{const _a357=()=>{if(inactivityTimerRef.current)clearTimeout(inactivityTimerRef.current);inactivityTimerRef.current=setTimeout(()=>{alert("You have been logged out due to inactivity.");_a358()},3600000)};if(secretCode){const _a359=['mousemove','keypress','click','scroll'];_a359.forEach(event=>window.addEventListener(event,_a357));_a357();return()=>{_a359.forEach(event=>window.removeEventListener(event,_a357));if(inactivityTimerRef.current)clearTimeout(inactivityTimerRef.current)}}}, [secretCode]);const _a358=async()=>{console.log("Logging out...");if(window.gapiAccessToken){google.accounts.oauth2.revoke(window.gapiAccessToken.access_token);window.gapiAccessToken=null;if(window.chatbotStorage)await window.chatbotStorage.removeAuthToken();setIsGoogleAuthed(false)}setSecretCode(null);if(window.chatbotStorage)await window.chatbotStorage.removeSecretCode();sessionStorage.removeItem('importAlertShown');if(exportIntervalRef.current)clearInterval(exportIntervalRef.current);if(inactivityTimerRef.current)clearTimeout(inactivityTimerRef.current);window.location.href='/'};const _a360=(_a361)=>{setUpdateCards(prevCards=>{const _a362=prevCards.some(c=>c.id===_a361.id);if(_a362){return prevCards.map(c=>c.id===_a361.id?_a361:c)}else{return[...prevCards,_a361]}});setCurrentView({screen:'updates-dashboard'})};const _a363=(_a344)=>{setUpdateCards(prevCards=>prevCards.filter(c=>c.id!==_a344))};if(!isDataLoaded||isAuthLoading){return(<div className="h-screen flex flex-col justify-center items-center bg-gray-100"><div className="text-center"><div className="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"></div><h2 className="text-xl font-semibold text-gray-700">{isAuthLoading?'Authenticating...':'Loading Your CA...'}</h2><div className="w-64 bg-gray-200 rounded-full h-2"><div className="bg-blue-500 h-2 rounded-full transition-all" style={{width:`${loadingProgress}%`}}></div></div></div></div>)}if(!userProfile.name){return<UserProfileSetup userProfile={userProfile} onSave={setUserProfile} isInitialSetup={true}/>}const _a364=()=>{switch(currentView.screen){case'chats':return(<_a309 characters={characters} groups={groups} onSelectCharacter={(id)=>setCurrentView({screen:'chat-single',id})} onSelectGroup={(id)=>setCurrentView({screen:'chat-group',id})} onNavigateToUpdates={()=>setCurrentView({screen:'updates-dashboard'})} setCharacters={setCharacters} setGroups={setGroups} setUserProfile={setUserProfile} setChatBackground={setChatBackground} userProfile={userProfile} chatBackground={chatBackground} isGoogleAuthed={isGoogleAuthed} onLogout={_a358}/>) ;case'chat-single':const _a365=characters.find(c=>c.id===currentView.id);if(!_a365){setCurrentView({screen:'chats'});return null}return(<_a248 character={_a365} userProfile={userProfile} onCharacterUpdate={(updatedCharacter)=>setCharacters(prev=>prev.map(c=>c.id===updatedCharacter.id?updatedCharacter:c))} onBack={()=>setCurrentView({screen:'chats'})} onUserProfileUpdate={setUserProfile} backgroundUrl={chatBackground} onSetBackground={setChatBackground}/>) ;case'chat-group':const _a366=groups.find(g=>g.id===currentView.id);if(!_a366){setCurrentView({screen:'chats'});return null}return(<_a289 group={_a366} characters={characters} userProfile={userProfile} onGroupUpdate={(updatedGroup)=>setGroups(prev=>prev.map(g=>g.id===updatedGroup.id?updatedGroup:g))} onBack={()=>setCurrentView({screen:'chats'})} onUserProfileUpdate={setUserProfile} backgroundUrl={chatBackground} onSetBackground={setChatBackground}/>) ;case'updates-dashboard':return(<_a340 cards={updateCards} onNavigateBack={()=>setCurrentView({screen:'chats'})} onNavigateToForm={(card)=>setCurrentView({screen:'updates-form',card:card})} onNavigateToView={(card)=>setCurrentView({screen:'updates-view',card:card})} onCardUpdate={_a360} onCardDelete={_a363}/>) ;case'updates-form':return(<_a330 initialCard={currentView.card} onSave={_a360} onCancel={()=>setCurrentView({screen:'updates-dashboard'})}/>) ;case'updates-view':if(!currentView.card){setCurrentView({screen:'updates-dashboard'});return null}return(<_a333 card={currentView.card} onBack={()=>setCurrentView({screen:'updates-dashboard'})}/>) ;default:setCurrentView({screen:'chats'});return null}};return(<div className="app-container">{showDrivePrompt&&<_a344 onConnect={()=>{_a61();setShowDrivePrompt(false)}} onSkip={()=>setShowDrivePrompt(false)}/>}{_a364()}</div>)};const _a355=async()=>{console.log("ðŸ“¥ Checking for data to import...");const _a367=await _a2._a3('Virtual Tax Friend Data');if(!_a367)return;const _a368=`TaxFriend_data.json`;const _a369=await _a2._a14(_a368,_a367);if(_a369){const _a370=await _a2._a47(_a369);if(_a370&&typeof _a370==='object'){console.log("âœ… Data found on Drive, importing...");const _a371={userProfile:_a370.userProfile||null,characters:Array.isArray(_a370.characters)?_a370.characters:[],groups:Array.isArray(_a370.groups)?_a370.groups:[],updateCards:Array.isArray(_a370.updateCards)?_a370.updateCards:[]};await window.chatbotStorage.setAllData(_a371);if(_a371.userProfile)setUserProfile(_a371.userProfile);setCharacters(_a371.characters);setGroups(_a371.groups);setUpdateCards(_a371.updateCards);if(!sessionStorage.getItem('importAlertShown')){alert("Chat history and data imported from Google Drive!");sessionStorage.setItem('importAlertShown','true')}}else{console.warn("âš ï¸ Import skipped: Data from Drive was empty or corrupted.")}}else{console.log(`No previous data found on Drive.`)}};const _a356=async()=>{if(!secretCode||!isGoogleAuthed)return;const _a372=await window.chatbotStorage.getAllData();if(!_a372.userProfile){console.log("Export skipped: User profile not found.");return}console.log("ðŸš€ Syncing data with Google Drive...");const _a367=await _a2._a3('Virtual Tax Friend Data');if(!_a367)return;const _a368=`TaxFriend_data.json`;const _a369=await _a2._a14(_a368,_a367);if(_a369){await _a2._a37(_a369,_a372)}else{await _a2._a22(_a368,_a372,_a367)}};const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<App/>);</script></body></html>
